{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"electron\"","webpack:///external \"crypto\"","webpack:///./src/utils/session.ts","webpack:///./src/constants.ts","webpack:///./src/browser/handler-factory.ts","webpack:///./src/browser/background-pages.ts","webpack:///external \"events\"","webpack:///./src/browser/index.ts","webpack:///./src/utils/web-contents.ts","webpack:///./src/utils/string.ts","webpack:///external \"path\"","webpack:///./src/utils/web-request.ts","webpack:///./src/index.ts","webpack:///./src/browser/cookies.ts","webpack:///external \"url\"","webpack:///./src/browser/tabs.ts","webpack:///external \"fs\"","webpack:///./src/browser/windows.ts","webpack:///./src/browser/web-request-electron.ts","webpack:///./src/utils/url.ts","webpack:///./src/browser/web-request-api.ts","webpack:///./src/browser/browser-action.ts","webpack:///./node_modules/uuid/dist/esm-node/rng.js","webpack:///./node_modules/uuid/dist/esm-node/bytesToUuid.js","webpack:///./node_modules/uuid/dist/esm-node/v1.js","webpack:///./node_modules/uuid/dist/esm-node/v35.js","webpack:///./node_modules/uuid/dist/esm-node/v3.js","webpack:///./node_modules/uuid/dist/esm-node/md5.js","webpack:///./node_modules/uuid/dist/esm-node/v4.js","webpack:///./node_modules/uuid/dist/esm-node/v5.js","webpack:///./node_modules/uuid/dist/esm-node/sha1.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","fallbackSession","_setFallbackSession","ses","sessionFromIpcEvent","e","sender","session","defaultSession","WINDOW_ID_NONE","WINDOW_ID_CURRENT","TAB_ID_NONE","PROTOCOL","PROTOCOL_SCHEME","scope","fn","includeEvent","ipcMain","handle","args","slice","sendToExtensionPages","channel","webContents","getAllWebContents","forEach","wc","isDestroyed","getURL","startsWith","send","BackgroundPages","EventEmitter","super","app","on","isBackgroundPage","this","emit","extensionId","find","x","parse","hostname","Extensions","tabs","TabsAPI","cookies","CookiesAPI","windows","WindowsAPI","webRequest","WebRequestAPI","browserAction","BrowserActionAPI","backgroundPages","preloadPath","getPreloads","includes","Error","setPreloads","concat","hookExtensionWebRequestBypass","observeSession","instance","extensions","getType","webContentsInvoke","Promise","resolve","id","randomId","once","a","defaultResolver","listeners","sort","b","context","order","reduce","async","accumulator","element","cancel","result","apply","methodsWithCallback","aliasMethods","BetterWebRequest","orderIndex","Map","filters","resolvers","method","parameters","parseArguments","identifyAction","filter","action","outerContext","urls","innerContext","nextIndex","listener","has","set","Set","currentFilters","url","add","listenerFactory","size","clearListeners","delete","newFilters","mergeFilters","clear","resolver","hasCallback","console","warn","Array","from","values","some","matchesPattern","details","callback","matchedListeners","matchListeners","length","requestsProcesses","processRequests","map","requestListeners","appliers","makeApplier","push","reject","err","unbind","addListener","aliasHandler","target","alias","betterWebRequest","Proxy","store","writable","ELECTRON_TO_CHROME_COOKIE_CHANGE_CAUSE","explicit","overwrite","expired","evicted","handler","HandlerFactory","getAll","remove","electronCookie","electronCause","removed","cookie","getChromeCookie","cause","domain","hostOnly","path","secure","httpOnly","sameSite","expirationDate","storeId","getParentWindowOfTab","tab","BrowserWindow","fromWebContents","getOwnerBrowserWindow","detailsCache","getDetails","createDetails","getSelected","getAllInWindow","query","update","reload","getCurrent","insertCSS","tabId","updateProperties","getTabById","muted","active","loadURL","setAudioMuted","activate","onUpdated","additionalArgs","activeChanged","tabInfo","cacheTab","windowId","tabIds","isArray","info","isSet","pinned","audible","mutedInfo","highlighted","discarded","autoDiscardable","status","title","index","onCreate","onRemoved","eventName","event","favicons","favicon","onCreated","reloadProperties","bypassCache","reloadIgnoringCache","code","promises","readFile","getExtension","file","cssOrigin","window","width","height","getSize","prevDetails","selected","incognito","isCurrentlyAudible","favIconUrl","undefined","audioMuted","isLoading","getTitle","onCreateDetails","compareProps","didUpdate","changeInfo","prop","win","getWindowById","isWindowClosing","getInfo","getDetailsMatchingGetInfo","lastFocused","tabDetails","windowTypes","type","populate","getLastFocused","getHandler","updateInfo","left","top","state","bounds","getBounds","newBounds","isNaN","Math","floor","y","setBounds","drawAttention","flashFrame","isFocused","focused","focus","onBeforeFocusNextZOrder","windowIdToFocus","minimize","maximize","setFullScreen","isFullScreen","isMinimized","restore","isMaximized","unmaximize","Boolean","alwaysOnTop","isAlwaysOnTop","requestsOrigins","requestIsForExtension","origin","requestHasExtensionOrigin","resourceType","requestIsXhrOrSubframe","onBeforeSendHeaders","requestHeaders","Origin","webContentsId","fromId","requestIsFromBackgroundPage","requestIsOption","onHeadersReceived","responseHeaders","val","toLowerCase","allowedOriginIsWildcard","pattern","regexp","RegExp","replace","match","clearCacheOnNavigation","listenerId","getOwnPropertyNames","returnedDetails","newDetails","requestId","toString","frameId","parentFrameId","timeStamp","Date","now","error","keys","k","electronToChromeDetails","headers","newHeaders","header","chromeToElectronHeaders","removeListener","CHROME_DETAILS_KEYS","badgeText","badgeBackgroundColor","resolvePath","extensionUrl","isAbsolute","resolveIconPaths","icon","newIcon","entries","sessionActionMap","setter","propName","getOrCreate","newValue","imageData","baseUrl","popup","actionToUpdate","charAt","toUpperCase","substring","getAllHandler","getAllInTab","onClicked","getAllInSession","sessionActions","extension","browser_action","manifest","default_popup","default_title","default_icon","assign","rng","randomBytes","byteToHex","substr","_nodeId","_clockseq","buf","offset","bth","join","_lastMSecs","_lastNSecs","options","node","clockseq","seedBytes","random","msecs","getTime","nsecs","dt","tl","tmh","generateUUID","namespace","off","str","unescape","encodeURIComponent","bytes","charCodeAt","stringToBytes","uuid","hex","parseInt","uuidToBytes","TypeError","hashfunc","version","idx","DNS","URL","v35","Buffer","createHash","digest","rnds","ii"],"mappings":"2BACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QA0Df,OArDAF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,I,gBClFrDhC,EAAOD,QAAUkC,QAAQ,a,cCAzBjC,EAAOD,QAAUkC,QAAQ,W,8ECAzB,aAEA,IAAIC,EAES,EAAAC,oBAAuBC,IAClCF,EAAkBE,GAGP,EAAAC,oBAAuBC,GAClCA,EAAEC,OAAOC,SAAWN,GAAmB,EAAAM,QAAQC,gB,8ECTpC,EAAAC,gBAAkB,EAClB,EAAAC,mBAAqB,EAErB,EAAAC,aAAe,EAEf,EAAAC,SAAW,mBACX,EAAAC,gBAAqB,EAAAD,SAAH,O,8ECN/B,aAEA,uBACS,cAAcE,EAAetB,GAClC,MAAO,CAACjB,EAAcwC,EAA8BC,GAAe,IACjE,EAAAC,QAAQC,OAAO,GAAGJ,KAASvC,IAAQ,IAAI4C,KAChCH,IAAcG,EAAOA,EAAKC,MAAM,IAC9BL,EAAGvB,KAAKA,EAARuB,IAAiBI,Q,8ECPhC,aACA,QACA,OACA,OACA,OAEa,EAAAE,qBAAuB,CAACC,KAAoBH,KACvD,EAAAI,YAAYC,oBAAoBC,QAASC,KACnCA,EAAGC,eAAkBD,EAAGE,SAASC,WAAW,EAAAhB,kBAChDa,EAAGI,KAAKR,KAAYH,MAYxB,MAAaY,UAAwB,EAAAC,aACnC,cACEC,QAEA,EAAAC,IAAIC,GAAG,uBAAwB,CAAC9B,EAAGqB,KAC7B,EAAAU,iBAAiBV,IACnBW,KAAKC,KAAK,UAAW,EAAAf,eAKpB,IAAIgB,EAAqBhC,GAC9B,OAAO,EAAAgB,YACJC,oBACAgB,KACEC,GACC,EAAAL,iBAAiBK,IACjB,EAAAC,MAAMD,EAAEb,UAAUe,WAAaJ,GAC/BE,EAAElC,UAAYA,IAlBxB,qB,cCrBAxC,EAAOD,QAAUkC,QAAQ,W,8ECAzB,cACA,QACA,OACA,QACA,QACA,QACA,QAEA,MAAa4C,EAAb,cAGS,KAAAC,KAAO,IAAI,EAAAC,QACX,KAAAC,QAAU,IAAI,EAAAC,WACd,KAAAC,QAAU,IAAI,EAAAC,WACd,KAAAC,WAAa,IAAI,EAAAC,cACjB,KAAAC,cAAgB,IAAI,EAAAC,iBAEpB,KAAAC,gBAAkB,IAAI,EAAAxB,gBAEtB,kBAAkBxB,EAA2BiD,GAClD,GAAIjD,EAAQkD,cAAcC,SAASF,GACjC,MAAM,IAAIG,MACR,kEAGJpD,EAAQqD,YAAYrD,EAAQkD,cAAcI,OAAOL,IAEjD,EAAAM,8BAA8BvD,GAC9B8B,KAAKU,QAAQgB,eAAexD,IApBhC,eACgB,EAAAyD,SAAW,IAAIpB,EAuBlB,EAAAqB,WAAarB,EAAWoB,S,4DAErC,Q,8EClCA,aACA,OACA,OAGa,EAAA5B,iBAAoBV,GAEd,WAAjBA,EAAGwC,WAA0BxC,EAAGE,SAASC,WAAW,EAAAhB,iBAEzC,EAAAsD,kBAAoB,CAC/BzC,EACAJ,KACGH,IAEH,IAAIiD,QAASC,IACX,MAAMC,EAAK,EAAAC,WAEX,EAAAtD,QAAQuD,KAAK,GAAGlD,KAAWgD,IAAM,CAACjE,KAAWoE,IAAaJ,KAAWI,IAErE/C,EAAGI,KAAKR,KAAYH,EAAMmD,M,8ECnB9B,cAEa,EAAAC,SAAW,IAAM,Q,cCF9BxG,EAAOD,QAAUkC,QAAQ,S,8ECEzB,cACA,OAkDM0E,EAAmBC,GACNA,EACdC,KAAK,CAACH,EAAGI,IAAMA,EAAEC,QAAQC,MAAQN,EAAEK,QAAQC,OAC3CC,OACCC,MAAOC,EAAkBC,KACvB,GAAID,EAAYE,OACd,OAAOF,EAGT,MAAMG,QAAeF,EAAQG,QAE7B,OAAO,OAAP,wBAAYJ,GAAgBG,IAE9B,CAAED,QAAQ,IAMVG,EAAsB,CAC1B,kBACA,sBACA,qBAGIC,EAAe,CACnB,kBACA,sBACA,oBACA,gBACA,oBACA,mBACA,cACA,mBAGF,MAAaC,EAQX,YAAYtC,GACVd,KAAKqD,WAAa,EAClBrD,KAAKc,WAAaA,EAClBd,KAAKsC,UAAY,IAAIgB,IACrBtD,KAAKuD,QAAU,IAAID,IACnBtD,KAAKwD,UAAY,IAAIF,IAGvB,gBACE,OAAQtD,KAAKqD,YAAc,EAG7B,eACE,OAAOrD,KAAKsC,UAGd,gBAAgBmB,GACd,OAAOzD,KAAKsC,UAAU9F,IAAIiH,GAG5B,aACE,OAAOzD,KAAKuD,QAGd,cAAcE,GACZ,OAAOzD,KAAKuD,QAAQ/G,IAAIiH,GAG1B,YAAYA,GACV,OAAOP,EAAoB7B,SAASoC,GAGtC,MAAMA,EAA0BC,GAC9B,MAAM5E,EAAOkB,KAAK2D,eAAeD,GACjC,OAAO1D,KAAK4D,eAAeH,EAAQ3E,GAGrC,YACE2E,EACAI,EACAC,EACAC,EAAkC,IAElC,MAAM,KAAEC,GAASH,EACX5B,EAAK,EAAAC,WACL+B,EAAe,CAAEvB,MAAO1C,KAAKkE,WAE7BC,EAAW,CACflC,KACA+B,OACAF,SACArB,QALc,OAAH,wBAAQsB,GAAiBE,IAQjCjE,KAAKsC,UAAU8B,IAAIX,IACtBzD,KAAKsC,UAAU+B,IAAIZ,EAAQ,IAAIH,KAGjCtD,KAAKsC,UAAU9F,IAAIiH,GAASY,IAAIpC,EAAIkC,GAE/BnE,KAAKuD,QAAQa,IAAIX,IACpBzD,KAAKuD,QAAQc,IAAIZ,EAAQ,IAAIa,KAG/B,MAAMC,EAAiBvE,KAAKuD,QAAQ/G,IAAIiH,GACxC,IAAK,MAAMe,KAAOR,EAChBO,EAAeE,IAAID,GAQrB,OALAxE,KAAKc,WAAW2C,GACd,CAAEO,KAAM,IAAIO,IACZvE,KAAK0E,gBAAgBjB,IAGhBU,EAGT,eAAeV,EAA0BxB,GACvC,MAAMK,EAAYtC,KAAKsC,UAAU9F,IAAIiH,GAErC,GAAKnB,GAAcA,EAAU8B,IAAInC,GAIjC,GAAuB,IAAnBK,EAAUqC,KACZ3E,KAAK4E,eAAenB,OACf,CACLnB,EAAUuC,OAAO5C,GAEjB,MAAM6C,EAAa9E,KAAK+E,aAAazC,GACrCtC,KAAKuD,QAAQc,IAAIZ,EAAQqB,GAEzB9E,KAAKc,WAAW2C,GACd,CAAEO,KAAM,IAAIc,IACZ9E,KAAK0E,gBAAgBjB,KAK3B,eAAeA,GACb,MAAMnB,EAAYtC,KAAKsC,UAAU9F,IAAIiH,GAC/BF,EAAUvD,KAAKuD,QAAQ/G,IAAIiH,GAE7BnB,GAAWA,EAAU0C,QACrBzB,GAASA,EAAQyB,QAErBhF,KAAKc,WAAW2C,GAAQ,MAG1B,YAAYA,EAA0BwB,GAC/BjF,KAAKkF,YAAYzB,GAOtBzD,KAAKwD,UAAUa,IAAIZ,EAAQwB,GANzBE,QAAQC,KACN,iBAAiB3B,kDAQvB,eAAee,EAAalC,GAG1B,OAFuB+C,MAAMC,KAAKhD,EAAUiD,UAEtB1B,OAAQf,GAC5BA,EAAQkB,KAAKwB,KAAM5I,GAAU,EAAA6I,eAAe7I,EAAO4H,KAI/C,gBAAgBf,GACtB,OAAOb,MAAO8C,EAAcC,KAC1B,IAAK3F,KAAKsC,UAAU8B,IAAIX,GAEtB,YADAzD,KAAKc,WAAW2C,GAAQ,MAI1B,MAAMnB,EAAYtC,KAAKsC,UAAU9F,IAAIiH,GAErC,IAAKnB,EAEH,YADIqD,GAAUA,EAAS,CAAE5C,QAAQ,KAInC,MAAM6C,EAAmB5F,KAAK6F,eAAeH,EAAQlB,IAAKlC,GAE1D,GAAgC,IAA5BsD,EAAiBE,OAEnB,YADIH,GAAUA,EAAS,CAAE5C,QAAQ,KAInC,IAAIf,EAAUhC,KAAKwD,UAAUhH,IAAIiH,GAE5BzB,IACHA,EAAUK,GAGZ,MAAM0D,EAAoB/F,KAAKgG,gBAAgBN,EAASE,GAExD,GAAI5F,KAAKkF,YAAYzB,IAAWkC,EAAU,CAExCA,QADuB3D,EAAQ+D,SAG/BA,EAAkBE,IAAK9B,GAAaA,EAASlB,UAK3C,gBACNyC,EACAQ,GAEA,MAAMC,EAAuB,GAE7B,IAAK,MAAMhC,KAAY+B,EAAkB,CACvC,MAAMjD,EAAQjD,KAAKoG,YAAYV,EAASvB,EAASL,QAEjDqC,EAASE,KAAK,CACZpD,QACAR,QAAS0B,EAAS1B,UAItB,OAAO0D,EAGD,YAAYT,EAAcvB,GAChC,MAAO,IACL,IAAIpC,QAAQ,CAACC,EAASsE,KACpB,IACEnC,EAASuB,EAAS1D,GAClB,MAAOuE,GACPD,EAAOC,MAKP,aAAajE,GAGnB,OAFuB+C,MAAMC,KAAKhD,EAAUiD,UAEtB5C,OAAO,CAACE,EAAajG,KACzC,IAAK,MAAM4H,KAAO5H,EAAMoH,KAAMnB,EAAY4B,IAAID,GAC9C,OAAO3B,GACN,IAAIyB,KAGD,eAAeZ,GACrB,MAAM5E,EAAO,CACX0H,QAAQ,EACR3C,OAAQ,CAAEG,KAAM,CAAC,eACjBF,OAAQ,KACRrB,QAAS,IAGX,OAAQiB,EAAWoC,QACjB,KAAK,EACHhH,EAAK0H,QAAS,EACd,MAEF,KAAK,EACH,GAA6B,mBAAlB9C,EAAW,GAAmB,CACvC5E,EAAKgF,OAASJ,EAAW,GACzB,MAGF,MAAM,IAAIpC,MACR,yDAGJ,KAAK,EACH,GAC2B,iBAAlBoC,EAAW,IACO,mBAAlBA,EAAW,GAClB,CACA5E,EAAK+E,OAASH,EAAW,GACzB5E,EAAKgF,OAASJ,EAAW,GACzB,MAGF,GAA6B,mBAAlBA,EAAW,GAAmB,CACvC5E,EAAKgF,OAASJ,EAAW,GACzB5E,EAAK2D,QAAUiB,EAAW,GAC1B,MAGF,MAAM,IAAIpC,MACR,8FAGJ,KAAK,EACH,GAC2B,iBAAlBoC,EAAW,IACO,mBAAlBA,EAAW,GAClB,CACA5E,EAAK+E,OAASH,EAAW,GACzB5E,EAAKgF,OAASJ,EAAW,GACzB5E,EAAK2D,QAAUiB,EAAW,GAC1B,MAGF,MAAM,IAAIpC,MACR,6GAGJ,QACE,MAAM,IAAIA,MAAM,iDAGpB,OAAOxC,EAGD,eAAe2E,EAA0B3E,GAC/C,MAAM,OAAE0H,EAAM,OAAE3C,EAAM,OAAEC,EAAM,QAAErB,GAAY3D,EAE5C,GAAI0H,EACF,OAAOxG,KAAK4E,eAAenB,GAG7B,IAAKK,EACH,MAAM,IAAIxC,MAAM,oBAAoBmC,8BAGtC,OAAOzD,KAAKyG,YAAYhD,EAAQI,EAAQC,EAAQrB,IAhSpD,qBAoSA,MAAMiE,EAAe,CACnBlK,IAAK,CAACmK,EAA0BrJ,IAC1B6F,EAAa9B,SAAS/D,GACjB,IAAIoG,KACTiD,EAAOC,MAAMtJ,EAAUoG,IAInBiD,EAAerJ,IAIrBuJ,EAAoB3I,GACjB,IAAI4I,MAAM,IAAI1D,EAAiBlF,EAAQ4C,YAAa4F,GAGvDK,EAAQ,IAAIzC,IAiBlB,UAfkCpG,IAC5B6I,EAAM3C,IAAIlG,KAId7B,OAAOC,eAAe4B,EAAS,aAAc,CAC3CtB,MAAOiK,EAAiB3I,GACxB8I,UAAU,IAGZD,EAAMtC,IAAIvG,IARDA,I,0ICjZX,Q,8ECAA,aACA,OACA,OAEM+I,EAAoE,CACxEC,SAAU,WACVC,UAAW,YACXC,QAAS,UACTC,QAAS,UACT,oBAAqB,qBAGvB,mBACE,cACE,MAAMC,EAAU,EAAAC,eAAetK,OAAO,UAAW+C,MAEjDsH,EAAQ,MAAOtH,KAAKxD,KAAK,GACzB8K,EAAQ,SAAUtH,KAAKwH,QAAQ,GAC/BF,EAAQ,MAAOtH,KAAKqE,KAAK,GACzBiD,EAAQ,SAAUtH,KAAKyH,QAAQ,GAG1B,eAAe3J,GACpBA,EAAI4C,QAAQZ,GACV,UACA,CAAC9B,EAAQ0J,EAAqBC,EAAoBC,KAChD,MAGMlC,EAAU,CACdmC,OAJa7H,KAAK8H,gBAAgBJ,GAKlCK,MAJYd,EAAuCU,GAKnDC,WAGF,EAAA5I,qBAAqB,oBAAqB0G,KAKxC,gBAAgBmC,GACtB,MAAO,CACL3L,KAAM2L,EAAO3L,KACbU,MAAOiL,EAAOjL,MACdoL,OAAQH,EAAOG,OACfC,SAAUJ,EAAOI,SACjBC,KAAML,EAAOK,KACbC,OAAQN,EAAOM,OACfC,SAAUP,EAAOO,SACjBC,SAAU,iBACVnK,QAAS2J,EAAO3J,QAChBoK,eAAgBT,EAAOS,eACvBC,QAAS,KAIL,aACNvK,EACA0H,GAEA,MAAM,IAAElB,EAAG,KAAEtI,EAAI,OAAE8L,EAAM,KAAEE,EAAI,OAAEC,EAAM,QAAEjK,GAAYwH,EAE/ChF,QAAgB,EAAA3C,oBAAoBC,GAAG0C,QAAQlE,IAAI,CACvDgI,MACAtI,OACA8L,SACAE,OACAC,SACAjK,YAGF,OAAIwC,EACKA,EAAQuF,IAAKjK,GAAMgE,KAAK8H,gBAAgB9L,IAG1C,GAGD,UAAUgC,EAA0B0H,GAC1C,MAAM,IAAElB,EAAG,KAAEtI,GAASwJ,EAEhBhF,QAAgB,EAAA3C,oBAAoBC,GAAG0C,QAAQlE,IAAI,CAAEgI,MAAKtI,SAEhE,GAAIwE,GAAWA,EAAQ,GAAI,CACzB,MAAMmH,EAASnH,EAAQ,GACvB,OAAOV,KAAK8H,gBAAgBD,GAG9B,OAAO,KAGD,UACN7J,EACA0H,GAEA,MAAM,IACJlB,EAAG,KACHtI,EAAI,MACJU,EAAK,OACLoL,EAAM,KACNE,EAAI,OACJC,EAAM,SACNC,EAAQ,eACRE,GACE5C,EAaJ,aAXM,EAAA3H,oBAAoBC,GAAG0C,QAAQ2D,IAAI,CACvCG,MACAtI,OACAU,QACAoL,SACAE,OACAC,SACAC,WACAE,mBAGK,CACLpM,OACAU,QACAoL,SACAE,OACAC,SACAC,WACAE,iBACAC,QAAS,MAIL,aACNvK,EACA0H,GAEA,MAAM,IAAElB,EAAG,KAAEtI,GAASwJ,EAGtB,aADM,EAAA3H,oBAAoBC,GAAG0C,QAAQ+G,OAAOjD,EAAKtI,GAC1C,CAAEsI,MAAKtI,OAAMqM,QAAS,S,cCxIjC7M,EAAOD,QAAUkC,QAAQ,Q,8ECCzB,aACA,QACA,QACA,OACA,OACA,OACA,OACA,OAEa,EAAA6K,qBAAwBC,IACnC,OAAQA,EAAI5G,WACV,IAAK,SACH,OAAO,EAAA6G,cAAcC,gBAAgBF,GACvC,IAAK,cACL,IAAK,UACH,OAAQA,EAAYG,0BAkC1B,MAAanI,UAAgB,EAAAd,aAI3B,cACEC,QAJM,KAAAY,KAAiB,IAAI8D,IACrB,KAAAuE,aAA0C,IAAIvF,IAuM/C,KAAAwF,WAAcL,GACdA,EAEDzI,KAAK6I,aAAazE,IAAIqE,GACjBzI,KAAK6I,aAAarM,IAAIiM,GAGxBzI,KAAK+I,cAAcN,GANT,KAnMjB,MAAMnB,EAAU,EAAAC,eAAetK,OAAO,OAAQ+C,MAE9CsH,EAAQ,MAAOtH,KAAKxD,KACpB8K,EAAQ,cAAetH,KAAKgJ,aAC5B1B,EAAQ,iBAAkBtH,KAAKiJ,gBAC/B3B,EAAQ,QAAStH,KAAKkJ,OACtB5B,EAAQ,SAAUtH,KAAKmJ,QACvB7B,EAAQ,SAAUtH,KAAKoJ,QACvB9B,EAAQ,SAAUtH,KAAK/C,QACvBqK,EAAQ,SAAUtH,KAAKyH,QAEvBH,EAAQ,aAActH,KAAKqJ,YAAY,GACvC/B,EAAQ,YAAatH,KAAKsJ,WAAW,GAMhC,aACLC,EACAC,GAEA,MAAMf,EAAMzI,KAAKyJ,WAAWF,GAC5B,IAAKd,EAAK,OAAO,KAEjB,MAAM,IAAEjE,EAAG,MAAEkF,EAAK,OAAEC,GAAWH,EAW/B,OARIhF,SAAWiE,EAAImB,QAAQpF,GAEN,kBAAVkF,GAAqBjB,EAAIoB,cAAcH,GAE9CC,GAAQ3J,KAAK8J,SAASP,GAE1BvJ,KAAK+J,UAAUtB,GAERzI,KAAK+I,cAAcN,GAGrB,SAASc,KAAkBS,GAChC,MAAMvB,EAAMzI,KAAKyJ,WAAWF,GAC5B,IAAKd,EAAK,OAEV,MAAM/C,EAAU1F,KAAK8I,WAAWL,GAE1BwB,GAAiBvE,EAAQiE,OAE/B3J,KAAK6I,aAAazJ,QAAQ,CAAC8K,EAASC,KAClCD,EAAQP,OAASJ,IAAUY,EAASlI,KAGjCgI,IAELjK,KAAKC,KAAK,YAAawI,EAAIxG,GAAIyD,EAAQ0E,YAAaJ,GACpD,EAAAhL,qBAAqB,mBAAoB,CACvCuK,QACAa,SAAU1E,EAAQ0E,YAIf,IAAIb,GACT,MAAMd,EAAMzI,KAAKyJ,WAAWF,GAC5B,OAAOvJ,KAAK8I,WAAWL,GAGlB,OAAO4B,GACRhF,MAAMiF,QAAQD,GAChBA,EAAOjL,QAAS6C,GAAOjC,KAAKC,KAAK,cAAegC,IAIlDjC,KAAKC,KAAK,cAAeoK,GAIpB,eAAeD,GACpB,OAAOpK,KAAKkJ,MAAM,CAAEkB,aAIf,YAAYA,GACjB,MAAwB,iBAAbA,EACFpK,KAAKkJ,MAAM,CAAEkB,WAAUT,QAAQ,IAEjC3J,KAAKkJ,MAAM,CAAES,QAAQ,IAGvB,MAAMY,EAA8B,IACzC,MAAMC,EAAS5N,QAAgC,IAAVA,EAwCrC,OAtCayI,MAAMC,KAAKtF,KAAKQ,MAC1ByF,IAAIjG,KAAK8I,YACTjF,OAAQ4E,KACH+B,EAAMD,EAAKZ,SAAWY,EAAKZ,SAAWlB,EAAIkB,YAC1Ca,EAAMD,EAAKE,SAAWF,EAAKE,SAAWhC,EAAIgC,YAC1CD,EAAMD,EAAKG,UAAYH,EAAKG,UAAYjC,EAAIiC,aAC5CF,EAAMD,EAAKb,QAAUa,EAAKb,QAAUjB,EAAIkC,UAAUjB,WAElDc,EAAMD,EAAKK,cAAgBL,EAAKK,cAAgBnC,EAAImC,iBAEpDJ,EAAMD,EAAKM,YAAcN,EAAKM,YAAcpC,EAAIoC,eAGlDL,EAAMD,EAAKO,kBACXP,EAAKO,kBAAoBrC,EAAIqC,qBAG3BN,EAAMD,EAAKQ,SAAWR,EAAKQ,SAAWtC,EAAIsC,YAC1CP,EAAMD,EAAKH,WAAaG,EAAKH,WAAa3B,EAAI2B,cAE9CI,EAAMD,EAAKS,QAAUT,EAAKS,QAAUvC,EAAIuC,UAE1CR,EAAMD,EAAK/F,MACX+F,EAAK/F,MAAQiE,EAAIjE,KACJ,eAAb+F,EAAK/F,eASRyB,IAAI,CAACwC,EAAKwC,KACTxC,EAAIwC,MAAQA,EACLxC,IAMN,aACL/C,GAEA,IAAK1F,KAAKkL,SACR,MAAM,IAAI5J,MAAM,6BAGlB,MAAMiI,QAAcvJ,KAAKkL,SAASxF,GAC5B+C,EAAMzI,KAAKyJ,WAAWF,GAC5B,OAAOvJ,KAAK8I,WAAWL,GAGlB,QAAQA,GACbzI,KAAKQ,KAAKiE,IAAIgE,GAEdA,EAAItG,KAAK,YAAa,KACpBnC,KAAKQ,KAAKqE,OAAO4D,GACjBzI,KAAKmL,UAAU1C,KAGW,CAC1B,qBACA,oBACA,mBACA,wBACA,eACA,uBACA,0BACA,wBAGWrJ,QAASgM,IACpB3C,EAAI3I,GAAGsL,EAAW,KAChBpL,KAAK+J,UAAUtB,OAInBA,EAAI3I,GAAG,uBAAwB,CAACuL,EAAOC,KACrC7C,EAAI8C,QAAUD,EAAS,GACvBtL,KAAK+J,UAAUtB,KAGjBzI,KAAKwL,UAAU/C,GAGV,OACLc,EACAkC,EAAiD,IAEjD,MAAMhD,EAAMzI,KAAKyJ,WAAWF,GACvBd,IAEDgD,EAAiBC,YACnBjD,EAAIkD,sBAEJlD,EAAIW,UAID,WAAWnH,GAChB,OAAOoD,MAAMC,KAAKtF,KAAKQ,MAAML,KAAMC,GAAMA,EAAE6B,KAAOA,GAa5C,WAAWjE,GACjB,MAAMyK,EAAMzI,KAAKyJ,WAAWzL,EAAEC,OAAOgE,IACrC,OAAKwG,EAEEzI,KAAK8I,WAAWL,GAFN,KAKX,gBACNzK,EACAkC,EACAqJ,EACA7D,GAEA,MAAM+C,EAAMzI,KAAKyJ,WAAWF,GAC5B,GAAKd,EAAL,CAEA,GAAI/C,EAAQlI,eAAe,QAAS,CAClC,MAAMM,EAAM,EAAAC,oBAAoBC,GAChC0H,EAAQkG,WAAa,EAAAC,SAASC,SAC5B,EAAA9J,QAAQlE,EAAIiO,aAAa7L,GAAagI,KAAMxC,EAAQsG,MACpD,QAIJvD,EAAIa,UAAU5D,EAAQkG,KAAM,CAC1BK,UAAWvG,EAAQuG,aAIf,cAAcxD,GACpB,MAAMyD,EAAS,EAAA1D,qBAAqBC,IAC7B0D,EAAQ,EAAGC,EAAS,GAAKF,EAASA,EAAOG,UAAY,GAEtDC,EAAwCtM,KAAK6I,aAAarM,IAC9DiM,IACG,CACHxG,GAAIwG,EAAIxG,GACR0H,QAAQ,EACRiB,aAAa,EACb2B,UAAU,EACVzB,iBAAiB,EACjBD,WAAW,EACX2B,WAAW,EACXvB,MAAO,EACPR,QAAQ,GAGJ/E,EAAO,+BACP4G,GAA+B,CACnC5B,QAASjC,EAAIgE,qBACbC,WAAYjE,EAAI8C,cAAWoB,EAC3BP,SACAD,QACAxB,UAAW,CAAEjB,MAAOjB,EAAImE,YACxB7B,OAAQtC,EAAIoE,YAAc,UAAY,WACtC7B,MAAOvC,EAAIqE,WACXtI,IAAKiE,EAAIlJ,SACT6K,SAAU8B,EAASA,EAAOjK,IAAM,IAOlC,OAJIjC,KAAK+M,iBAAiB/M,KAAK+M,gBAAgBtE,EAAK/C,GAEpD1F,KAAK6I,aAAaxE,IAAIoE,EAAK/C,GAEpBA,EAGD,UAAU+C,GAChB,IAAKA,EAAK,OAEV,MAAM6D,EAA2BtM,KAAK6I,aAAarM,IAAIiM,GACvD,IAAK6D,EAAa,OAElB,MAAM5G,EAAuB1F,KAAK+I,cAAcN,GAE1CuE,EAAe,CACnB,SACA,MACA,SACA,UACA,YACA,kBACA,YACA,aACA,SAGF,IAAIC,GAAY,EAChB,MAAMC,EAAkB,GAExB,IAAK,MAAMC,KAAQH,EACbtH,EAAQyH,KAAUb,EAAYa,KAChCD,EAAWC,GAAQzH,EAAQyH,GAC3BF,GAAY,GAIXA,IAELjN,KAAKC,KAAK,UAAWwI,EAAIxG,GAAIiL,EAAYxH,GACzC,EAAA1G,qBAAqB,iBAAkByJ,EAAIxG,GAAIiL,EAAYxH,IAGrD,UAAU+C,GAChB,MAAM/C,EAAU1F,KAAK6I,aAAazE,IAAIqE,GAClCzI,KAAK6I,aAAarM,IAAIiM,GACtB,KAEJzI,KAAK6I,aAAahE,OAAO4D,GAEzB,MAAM2B,EAAW1E,EAAUA,EAAQ0E,UAAY,EACzCgD,EAAM,EAAA7M,WAAWoB,SAASf,QAAQyM,cAAcjD,GAEtD,EAAApL,qBAAqB,iBAAkByJ,EAAIxG,GAAI,CAC7CmI,WACAkD,kBAAiBF,GAAMA,EAAI9N,gBAIvB,UAAUmJ,GAChB,MAAM/C,EAAU1F,KAAK8I,WAAWL,GAChC,EAAAzJ,qBAAqB,iBAAkB0G,IA5U3C,a,cClDAhK,EAAOD,QAAUkC,QAAQ,O,8ECCzB,aACA,OACA,OACA,OACA,OACA,OAmBA,MAAakD,UAAmB,EAAAlB,aAO9B,cACEC,QAPM,KAAAgB,QAA8B,IAAI0D,IAElC,KAAAuE,aAA0D,IAAIvF,IA+I9D,KAAA+F,WAAa,CACnBgC,EACAkC,KAEA,MAAM9E,EAAM,EAAAlI,WAAWoB,SAASnB,KAAKiJ,WAAW4B,EAAMpN,OAAOgE,IAE7D,IAAKwG,EACH,OAAI,EAAA1I,iBAAiBsL,EAAMpN,QAClB+B,KAAKwN,0BAA0BxN,KAAKyN,YAAaF,GAEnD,KAGT,MAAMG,EAAa,EAAAnN,WAAWoB,SAASnB,KAAKsI,WAAWL,GACjD2E,EAAMpN,KAAKqN,cAAcK,EAAWtD,UAE1C,OAAOpK,KAAKwN,0BAA0BJ,EAAKG,IA0CrC,KAAAC,0BAA4B,CAClCJ,EACAG,KAEA,IAAKH,EAAK,OAAO,KAEjB,MAAM1H,EAAU1F,KAAK8I,WAAWsE,GAEhC,IAAIO,EAAcJ,aAAO,EAAPA,EAASI,YAM3B,OAJKtI,MAAMiF,QAAQqD,KACjBA,EAAc,CAAC,SAAU,UAGtBA,EAAYtM,SAASqE,EAAQkI,OAER,KAAtBL,aAAO,EAAPA,EAASM,UACJ,OAAP,wBACKnI,GAAO,CACVlF,KAAM,EAAAD,WAAWoB,SAASnB,KAAK0I,MAAM,CAAEkB,SAAUgD,EAAInL,OAIlDyD,EATyC,MAhNhD,MAAM4B,EAAU,EAAAC,eAAetK,OAAO,UAAW+C,MAEjDsH,EAAQ,SAAUtH,KAAK/C,QACvBqK,EAAQ,SAAUtH,KAAKmJ,QACvB7B,EAAQ,SAAUtH,KAAKwH,QACvBF,EAAQ,iBAAkBtH,KAAK8N,gBAE/BxG,EAAQ,MAAOtH,KAAK+N,YAAY,GAChCzG,EAAQ,aAActH,KAAKqJ,YAAY,GAUlC,OAAOe,EAAkB4D,GAC9B,MAAMZ,EAAMpN,KAAKqN,cAAcjD,GAC/B,IAAKgD,EAAK,OAAO,KAEjB,MAAM,KAAEa,EAAI,IAAEC,EAAG,MAAE/B,EAAK,OAAEC,EAAM,MAAE+B,GAAUH,EAE5C,IAAK,CAAC,YAAa,YAAa,cAAc3M,SAAS8M,GAAQ,CAC7D,MAAMC,EAAShB,EAAIiB,YACbC,EAAS,iBAA4BF,GAEtCG,MAAMN,KAAOK,EAAUlO,EAAIoO,KAAKC,MAAMR,IACtCM,MAAML,KAAMI,EAAUI,EAAIF,KAAKC,MAAMP,KACrCK,MAAMpC,IAAUA,EAAQ,IAAGmC,EAAUnC,MAAQqC,KAAKC,MAAMtC,KACxDoC,MAAMnC,IAAWA,EAAS,IAAGkC,EAAUlC,OAASoC,KAAKC,MAAMrC,IAE5DgC,IAAWE,GACblB,EAAIuB,UAAUL,GAQlB,GAJwC,kBAA7BN,EAAWY,eACpBxB,EAAIyB,WAAWb,EAAWY,gBAAkBxB,EAAI0B,aAGhB,kBAAvBd,EAAWe,QACpB,GAAIf,EAAWe,QACC,cAAVZ,GAAuBf,EAAI4B,aAC1B,GACLhP,KAAKiP,0BACJ,CAAC,aAAc,aAAa5N,SAAS8M,GACtC,CACA,MAAMe,EAAkBlP,KAAKiP,wBAAwB7E,GACrDpK,KAAKgP,MAAME,GAaf,MATc,cAAVf,EAAuBf,EAAI+B,WACZ,cAAVhB,EAAuBf,EAAIgC,WACjB,eAAVjB,EAAwBf,EAAIiC,eAAc,GAChC,WAAVlB,IACHf,EAAIkC,gBAAgBlC,EAAIiC,eAAc,GACtCjC,EAAImC,eAAenC,EAAIoC,UACvBpC,EAAIqC,eAAerC,EAAIsC,cAGtB1P,KAAK+I,cAAcqE,GAGrB,MAAMhD,GACCpK,KAAKqN,cAAcjD,GAC3B4E,QAGC,OAAO5E,GACZpK,KAAKC,KAAK,cAAemK,GAGpB,QAAQ8B,GACblM,KAAKY,QAAQ6D,IAAIyH,GAEjBA,EAAO/J,KAAK,SAAU,KACpBnC,KAAKY,QAAQiE,OAAOqH,GACpBlM,KAAKmL,UAAUe,KAGjBA,EAAOpM,GAAG,QAAS,KACjBE,KAAKyN,YAAcvB,IAGrBlM,KAAKwL,UAAUU,GAGV,cAAcjK,GACnB,OAAOoD,MAAMC,KAAKtF,KAAKY,SAAST,KAAMC,GAAMA,EAAE6B,KAAOA,GAGhD,aACLyD,GAEA,IAAK1F,KAAKkL,SACR,MAAM,IAAI5J,MAAM,6BAGlB,MAAMW,QAAWjC,KAAKkL,SAASxF,GACzB0H,EAAMpN,KAAKqN,cAAcpL,GAC/B,OAAOjC,KAAK8I,WAAWsE,GAGlB,eACLG,GAEA,OAAOvN,KAAKwN,0BAA0BxN,KAAKyN,YAAaF,GAGnD,IACLtL,EACAsL,GAEA,MAAMH,EAAMpN,KAAKqN,cAAcpL,GAC/B,OAAOjC,KAAKwN,0BAA0BJ,EAAKG,GAGtC,OAAOA,GACZ,OAAOlI,MAAMC,KAAKtF,KAAKY,SACpBqF,IAAKmH,GAAQpN,KAAKwN,0BAA0BJ,EAAKG,IACjD1J,OAAO8L,SAGJ,WACNtE,EACApJ,EACAyD,GAEA,OAAOzD,IAAO,EAAA5D,kBACV2B,KAAKqJ,WAAWgC,EAAO3F,GACvB1F,KAAKxD,IAAIyF,EAAIyD,GAsBX,cAAc0H,GACpB,MAAM,EAAEhN,EAAC,EAAEsO,EAAC,MAAEvC,EAAK,OAAEC,GAAWgB,EAAIiB,YAEpC,IAAIF,EAAQ,SAERf,EAAIkC,eAAgBnB,EAAQ,aACvBf,EAAIqC,cAAetB,EAAQ,YAC3Bf,EAAImC,gBAAepB,EAAQ,aAEpC,MAAMzI,EAAiC,CACrCzD,GAAImL,EAAInL,GACR8M,QAAS3B,EAAI0B,YACbZ,IAAKQ,EACLT,KAAM7N,EACN+L,QACAC,SACAI,WAAW,EACXoB,KAAM,SACNO,QACAyB,YAAaxC,EAAIyC,iBAOnB,OAJI7P,KAAK+M,iBAAiB/M,KAAK+M,gBAAgBK,EAAK1H,GAEpD1F,KAAK6I,aAAaxE,IAAI+I,EAAK1H,GAEpBA,EAGD,WAAW0H,GACjB,OAAKA,EAEDpN,KAAK6I,aAAazE,IAAIgJ,GACjBpN,KAAK6I,aAAarM,IAAI4Q,GAGxBpN,KAAK+I,cAAcqE,GANT,KAmCX,UAAUA,GAChBpN,KAAKC,KAAK,cAAemN,EAAInL,IAC7B,EAAAjD,qBAAqB,oBAAqB,CACxCoL,SAAUgD,EAAInL,KAIV,UAAUmL,GAChB,MAAM1H,EAAU1F,KAAK8I,WAAWsE,GAChCpN,KAAKC,KAAK,UAAWyF,GACrB,EAAA1G,qBAAqB,oBAAqB0G,IAhP9C,gB,8ECzBA,aACA,QACA,OAwBMoK,EAAkB,IAAIxM,IAuBtByM,EAAyBrK,GAZG,CAACA,IACjC,MAAM,GAAEzD,GAAOyD,EAETsK,EAASF,EAAgBtT,IAAIyF,GAEnC,QAAI+N,GACKA,EAAOxQ,WAAW,EAAAhB,kBAO3ByR,CAA0BvK,IAtBG,CAACA,IAC9B,MAAM,aAAEwK,GAAiBxK,EAKzB,MAH+B,QAAjBwK,GACsB,aAAjBA,GAkBmBC,CAAuBzK,GAElD,EAAAjE,8BAAiCvD,IAC5C,UAAyBA,GAEzBA,EAAQ4C,WAAWsP,oBAAoB,CAAC1K,EAASC,KAG/C,GAFAmK,EAAgBzL,IAAIqB,EAAQzD,GAAIyD,EAAQ2K,eAAeC,SA9CvB,CAAC5K,IACnC,MAAM,cAAE6K,GAAkB7K,EAE1B,GAAI6K,EAAe,CACjB,MAAMlR,EAAK,EAAAH,YAAYsR,OAAOD,GAE9B,QAAIlR,GACKA,EAAGE,SAASC,WAAW,EAAAhB,iBAMlC,OAAO,GAoCFiS,CAA4B/K,IAC7BqK,EAAsBrK,KAxDJ,CAACA,IACvB,MAAM,OAAEjC,GAAWiC,EAEnB,MAAkB,YAAXjC,GAsDFiN,CAAgBhL,GAEjB,OAAOC,EAAS,CACd0K,eAAgB,OAAF,wBACT3K,EAAQ2K,gBAAc,CACzBC,OAAQ,SAKd3K,EAAS,CAAE0K,eAAgB3K,EAAQ2K,mBAGrCnS,EAAQ4C,WAAW6P,kBAAkB,CAACjL,EAASC,KAC7C,IAAK,MAAMzI,KAAOwI,EAAQkL,gBAAiB,CACzC,MAAMC,EAAMnL,EAAQkL,gBAAgB1T,UAC7BwI,EAAQkL,gBAAgB1T,GAC/BwI,EAAQkL,gBAAgB1T,EAAI4T,eAAiBD,EAG/C,MAEME,GADJrL,EAAQkL,gBAAgB,gCAAkC,IACHvP,SAAS,KAElEqE,EAAQkL,gBAAgB,oCAAsC,CAAC,SAE3Db,EAAsBrK,IAAYqL,KACpCrL,EAAQkL,gBAAgB,+BAAiC,CACvDd,EAAgBtT,IAAIkJ,EAAQzD,MAIhC6N,EAAgBjL,OAAOa,EAAQzD,IAE/B0D,EAAS,CAAEiL,gBAAiBlL,EAAQkL,sB,8EC/F3B,EAAAnL,eAAiB,CAACuL,EAAiBxM,KAC9C,GAAgB,eAAZwM,EACF,OAAO,EAGT,MAAMC,EAAS,IAAIC,OACjB,IAAIF,EAAQG,QAAQ,MAAO,MAAMA,QAAQ,IAAK,WAEhD,OAA4B,MAArB3M,EAAI4M,MAAMH,K,8ECRnB,aACA,OACA,OACA,QAEMI,EAAyB,KAC7B,EAAAnS,YAAYC,oBAAoBC,QAASC,IAGvCA,EAAGI,KAAK,eAFa,MA2CzB,sBACE,cASQ,KAAAgH,YAAc,CACpBzI,EACAsT,EACApV,EACA2H,KAEA,MAAM3F,EAAU,EAAAH,oBAAoBC,IAC9B,WAAE8C,GAAoB,UAAyB5C,GAGrD,IAAK7B,OAAOkV,oBAAoBzQ,EAAWA,YAAYO,SAASnF,GAC9D,OAEFmV,IAEA,MAAM,GAAEpP,GAAYnB,EAAW2F,YAC7BvK,EACA2H,EACAjB,MAAO8C,EAAcC,KACnB,MAAM6L,QAAwB,EAAA1P,kBAC5B9D,EAAEC,OACFqT,EAvDsB,CAAC5L,IAC/B,MAAM+L,EAAa,OAAH,wBACX/L,GAAO,CACVgM,UAAWhM,EAAQzD,GAAG0P,WACtBC,QAAS,EACTC,eAAgB,EAChBjE,MAnBiCA,EAmBClI,EAAQwK,aAlB/B,cAATtC,EAA6B,aACpB,aAATA,EAA4B,YACnB,cAATA,EAA6B,aAC1BA,GAgBLkE,UAAWC,KAAKC,MAChBzI,MAAO7D,EAAQ6K,cACf0B,MAAO,KAtByB,IAACrE,EAkCnC,OATI6D,EAAWb,kBACba,EAAWb,gBAAkBvU,OAAO6V,KAAKT,EAAWb,iBAAiB3K,IAClEkM,IAAM,CACLjW,KAAMiW,EACNvV,MAAO6U,EAAWb,gBAAgBuB,GAAG,OAKpCV,GAmCCW,CAAwB1M,IAG1B,OAAK8L,GAEDA,EAAgBZ,kBAClBY,EAAgBZ,gBApEM,CAACyB,IAC/B,MAAMC,EAAkB,GAExB,OADAD,EAAQjT,QAASmT,GAAiBD,EAAWC,EAAOrW,MAAQ,CAACqW,EAAO3V,QAC7D0V,GAiEmCE,CAChChB,EAAgBZ,kBAIbjL,EAAS6L,IARa7L,EAASD,KAY1C,EAAA9G,QAAQkB,GAAG,6BAA6BwR,EAAc,KACpDxQ,EAAW2R,eAAevW,EAAM+F,MA7ClC,EAAArD,QAAQkB,GAAG,cAAe,KACxBuR,MAGF,EAAAzS,QAAQkB,GAAG,yBAA0BE,KAAKyG,gB,8ECzD9C,aACA,OACA,OACA,QACA,OACA,OAkBMiM,EAAiD,CACrDC,UAAW,OACXC,qBAAsB,QACtB5H,MAAO,SAGH6H,EAAc,CAACC,EAAsB5K,KACzC,GAAKA,EACL,OAAIA,EAAK1I,WAAWsT,IAAiB,EAAAC,WAAW7K,GAAcA,EACvD,GAAG4K,IAAe5K,KAGrB8K,EAAmB,CAACF,EAAsBG,KAC9C,GAAoB,iBAATA,EAAmB,CAC5B,MAAMC,EAAoB,GAM1B,OALA7W,OAAO8W,QAAQF,GAAM7T,QAAQ,EAAElC,EAAKN,MACb,iBAAVA,IACTsW,EAAQhW,GAAO2V,EAAYC,EAAclW,MAGtCsW,EAGT,GAAoB,iBAATD,EACT,OAAOJ,EAAYC,EAAcG,IAYrC,MAAahS,UAAyB,EAAAtB,aAMpC,cACEC,QANM,KAAAwT,iBAGJ,IAAI9P,IAKN,MAAM+P,EAAUC,GAAqB,CACnCtV,EACAkC,EACAwF,KAMA,MAAM5H,EAAM,EAAAC,oBAAoBC,GAC1B8F,EAAS9D,KAAKuT,YAAYzV,EAAKoC,IAC/B,MAAEqJ,GAAU7D,EAElB,IAAI8N,EAAiB9N,EAAgBgN,EAAoBY,IAExC,SAAbA,EACFE,EACE9N,EAAQ+N,WAAaT,EAAiBlP,EAAO4P,QAAShO,EAAQwC,MAC1C,UAAboL,IACTE,EAAWX,EAAY/O,EAAO4P,QAAShO,EAAQiO,QAGjD,IAAIC,EAAsB9P,EAEtByF,IACEzF,EAAOtD,KAAK4D,IAAImF,GAClBqK,EAAiB9P,EAAOtD,KAAKhE,IAAI+M,IAEjCqK,EAAiB,GACjB9P,EAAOtD,KAAK6D,IAAIkF,EAAOqK,KAIvBA,EAAeN,KAAcE,IAC/BI,EAAeN,GAAYE,EAC3BxT,KAAKC,KAAK,UAAW6D,KAInBwD,EAAU,EAAAC,eAAetK,OAAO,gBAAiB+C,MAEvD,CACE,QACA,OACA,QACA,uBACA,aACAZ,QAAS+N,GACT7F,EACE,MAAM6F,EAAK0G,OAAO,GAAGC,gBAAgB3G,EAAK4G,UAAU,KACpDV,EAAOlG,IACP,IAIJ7F,EAAQ,SAAUtH,KAAKgU,eAAe,GAEtC1M,EAAQ,cAAetH,KAAKiU,aAC5B3M,EAAQ,YAAatH,KAAKkU,WAGpB,cAAc7I,GACpB,OAAOrL,KAAKmU,gBAAgB,EAAApW,oBAAoBsN,IAG1C,YAAYnN,EAA2BgC,GAC7C,IAAIkU,EAAiBpU,KAAKoT,iBAAiB5W,IAAI0B,GAC1CkW,IACHA,EAAiB,IAAI9Q,IACrBtD,KAAKoT,iBAAiB/O,IAAInG,EAASkW,IAGrC,IAAItQ,EAASsQ,EAAe5X,IAAI0D,GAUhC,OATK4D,IACHA,EAAS,CACPtD,KAAM,IAAI8C,IACVpD,cACAwT,QAAS,GAAG,EAAAlV,kBAAkB0B,MAEhCkU,EAAe/P,IAAInE,EAAa4D,IAG3BA,EAGF,iBACL5F,EACAmW,GAEA,MAAQC,eAAgBtT,GAAkBqT,EAAUE,UAAY,GAEhE,IAAKvT,EAAe,OAAO,KAE3B,MACEwT,cAAeb,EACfc,cAAezJ,EACf0J,aAAczB,GACZjS,EAEE8C,EAAS9D,KAAKuT,YAAYrV,EAASmW,EAAUpS,IASnD,OARA5F,OAAOsY,OAAO7Q,EAAQ,CACpB6P,MAAOd,EAAYwB,EAAU7P,IAAKmP,GAClCV,KAAMD,EAAiBqB,EAAU7P,IAAKyO,GACtCjI,UAGFhL,KAAKC,KAAK,SAAU6D,GAEbA,EAGF,gBAAgB5F,GACrB,MAAMkW,EAAiBpU,KAAKoT,iBAAiB5W,IAAI0B,GACjD,OAAKkW,EACE/O,MAAMC,KAAK8O,EAAe7O,UADL,GAIvB,YAAYgE,GACjB,MAAMd,EAAM,EAAAvJ,YAAYsR,OAAOjH,GAC/B,IAAKd,EAAK,MAAO,GAEjB,MAAM,QAAEvK,GAAYuK,EAGpB,OAFgBzI,KAAKmU,gBAAgBjW,GAEtB+H,IAAKnC,GAClBA,EAAOtD,KAAK4D,IAAImF,GACZ,OAAD,wBACMzF,GACAA,EAAOtD,KAAKhE,IAAI+M,IAErBzF,GAKD,UAAU5D,GACfF,KAAKC,KAAK,UAAWC,IAjJzB,sB,oMC1De,SAAS0U,IACtB,OAAO,IAAOC,YAAY,ICI5B,IAFA,IAAIC,EAAY,GAEP,EAAI,EAAG,EAAI,MAAO,EACzBA,EAAU,IAAM,EAAI,KAAOnD,SAAS,IAAIoD,OAAO,GAUlC,ICXXC,EAEAC,EDSW,EAPf,SAAqBC,EAAKC,GACxB,IAAIxZ,EAAIwZ,GAAU,EACdC,EAAMN,EAEV,MAAO,CAACM,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAO,IAAKyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAO,IAAKyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAO,IAAKyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAO,IAAKyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,MAAOyZ,EAAIF,EAAIvZ,OAAO0Z,KAAK,KCH/QC,EAAa,EACbC,EAAa,EAkFF,MAhFf,SAAYC,EAASN,EAAKC,GACxB,IAAIxZ,EAAIuZ,GAAOC,GAAU,EACrB3S,EAAI0S,GAAO,GAEXO,GADJD,EAAUA,GAAW,IACFC,MAAQT,EACvBU,OAAgC/I,IAArB6I,EAAQE,SAAyBF,EAAQE,SAAWT,EAInE,GAAY,MAARQ,GAA4B,MAAZC,EAAkB,CACpC,IAAIC,EAAYH,EAAQI,SAAWJ,EAAQZ,KAAOA,KAEtC,MAARa,IAEFA,EAAOT,EAAU,CAAgB,EAAfW,EAAU,GAAWA,EAAU,GAAIA,EAAU,GAAIA,EAAU,GAAIA,EAAU,GAAIA,EAAU,KAG3F,MAAZD,IAEFA,EAAWT,EAAiD,OAApCU,EAAU,IAAM,EAAIA,EAAU,KAQ1D,IAAIE,OAA0BlJ,IAAlB6I,EAAQK,MAAsBL,EAAQK,OAAQ,IAAI9D,MAAO+D,UAGjEC,OAA0BpJ,IAAlB6I,EAAQO,MAAsBP,EAAQO,MAAQR,EAAa,EAEnES,EAAKH,EAAQP,GAAcS,EAAQR,GAAc,IAarD,GAXIS,EAAK,QAA0BrJ,IAArB6I,EAAQE,WACpBA,EAAWA,EAAW,EAAI,QAKvBM,EAAK,GAAKH,EAAQP,SAAiC3I,IAAlB6I,EAAQO,QAC5CA,EAAQ,GAINA,GAAS,IACX,MAAM,IAAIzU,MAAM,mDAGlBgU,EAAaO,EACbN,EAAaQ,EACbd,EAAYS,EAIZ,IAAIO,GAA4B,KAAb,WAFnBJ,GAAS,cAE+BE,GAAS,WACjDvT,EAAE7G,KAAOsa,IAAO,GAAK,IACrBzT,EAAE7G,KAAOsa,IAAO,GAAK,IACrBzT,EAAE7G,KAAOsa,IAAO,EAAI,IACpBzT,EAAE7G,KAAY,IAALsa,EAET,IAAIC,EAAML,EAAQ,WAAc,IAAQ,UACxCrT,EAAE7G,KAAOua,IAAQ,EAAI,IACrB1T,EAAE7G,KAAa,IAANua,EAET1T,EAAE7G,KAAOua,IAAQ,GAAK,GAAM,GAE5B1T,EAAE7G,KAAOua,IAAQ,GAAK,IAEtB1T,EAAE7G,KAAO+Z,IAAa,EAAI,IAE1BlT,EAAE7G,KAAkB,IAAX+Z,EAET,IAAK,IAAItY,EAAI,EAAGA,EAAI,IAAKA,EACvBoF,EAAE7G,EAAIyB,GAAKqY,EAAKrY,GAGlB,OAAO8X,GAAY,EAAY1S,IClElB,sBACb,IAAI2T,EAAe,SAAUvZ,EAAOwZ,EAAWlB,EAAKC,GAClD,IAAIkB,EAAMnB,GAAOC,GAAU,EAG3B,GAFoB,iBAATvY,IAAmBA,EAjBlC,SAAuB0Z,GACrBA,EAAMC,SAASC,mBAAmBF,IAIlC,IAFA,IAAIG,EAAQ,IAAIpR,MAAMiR,EAAIxQ,QAEjBnK,EAAI,EAAGA,EAAI2a,EAAIxQ,OAAQnK,IAC9B8a,EAAM9a,GAAK2a,EAAII,WAAW/a,GAG5B,OAAO8a,EAQiCE,CAAc/Z,IAC5B,iBAAbwZ,IAAuBA,EA3BtC,SAAqBQ,GAEnB,IAAIH,EAAQ,GAIZ,OAHAG,EAAKzF,QAAQ,mBAAmB,SAAU0F,GACxCJ,EAAMpQ,KAAKyQ,SAASD,EAAK,QAEpBJ,EAqByCM,CAAYX,KACrD/Q,MAAMiF,QAAQ1N,GAAQ,MAAMoa,UAAU,mCAC3C,IAAK3R,MAAMiF,QAAQ8L,IAAmC,KAArBA,EAAUtQ,OAAe,MAAMkR,UAAU,+DAE1E,IAAIP,EAAQQ,EAASb,EAAU5U,OAAO5E,IAItC,GAHA6Z,EAAM,GAAgB,GAAXA,EAAM,GAAYS,EAC7BT,EAAM,GAAgB,GAAXA,EAAM,GAAY,IAEzBvB,EACF,IAAK,IAAIiC,EAAM,EAAGA,EAAM,KAAMA,EAC5BjC,EAAImB,EAAMc,GAAOV,EAAMU,GAI3B,OAAOjC,GAAO,EAAYuB,IAI5B,IACEN,EAAaja,KAAOA,EACpB,MAAOqK,IAKT,OAFA4P,EAAaiB,IA7BI,uCA8BjBjB,EAAakB,IA7BI,uCA8BVlB,GCnDM,MADJmB,EAAI,KAAM,ICArB,SAAab,GAOX,OANIpR,MAAMiF,QAAQmM,GAChBA,EAAQc,OAAOjS,KAAKmR,GACM,iBAAVA,IAChBA,EAAQc,OAAOjS,KAAKmR,EAAO,SAGtB,IAAOe,WAAW,OAAOrO,OAAOsN,GAAOgB,YCiBjC,MAvBf,SAAYjC,EAASN,EAAKC,GACxB,IAAIxZ,EAAIuZ,GAAOC,GAAU,EAEH,iBAAXK,IACTN,EAAkB,WAAZM,EAAuB,IAAInQ,MAAM,IAAM,KAC7CmQ,EAAU,MAIZ,IAAIkC,GADJlC,EAAUA,GAAW,IACFI,SAAWJ,EAAQZ,KAAOA,KAK7C,GAHA8C,EAAK,GAAe,GAAVA,EAAK,GAAY,GAC3BA,EAAK,GAAe,GAAVA,EAAK,GAAY,IAEvBxC,EACF,IAAK,IAAIyC,EAAK,EAAGA,EAAK,KAAMA,EAC1BzC,EAAIvZ,EAAIgc,GAAMD,EAAKC,GAIvB,OAAOzC,GAAO,EAAYwC,ICpBb,MADJJ,EAAI,KAAM,ICArB,SAAcb,GAOZ,OANIpR,MAAMiF,QAAQmM,GAChBA,EAAQc,OAAOjS,KAAKmR,GACM,iBAAVA,IAChBA,EAAQc,OAAOjS,KAAKmR,EAAO,SAGtB,IAAOe,WAAW,QAAQrO,OAAOsN,GAAOgB","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","module.exports = require(\"electron\");","module.exports = require(\"crypto\");","import { session } from 'electron';\n\nlet fallbackSession: Electron.Session;\n\nexport const _setFallbackSession = (ses: Electron.Session) => {\n  fallbackSession = ses;\n};\n\nexport const sessionFromIpcEvent = (e: Electron.IpcMainEvent) =>\n  e.sender.session || fallbackSession || session.defaultSession;\n","export const WINDOW_ID_NONE = -1;\nexport const WINDOW_ID_CURRENT = -2;\n\nexport const TAB_ID_NONE = -1;\n\nexport const PROTOCOL = 'chrome-extension';\nexport const PROTOCOL_SCHEME = `${PROTOCOL}://`;\n","import { ipcMain } from 'electron';\n\nexport class HandlerFactory {\n  public static create(scope: string, bind: any) {\n    return (name: string, fn: (...args: any[]) => void, includeEvent = false) =>\n      ipcMain.handle(`${scope}.${name}`, (...args: any[]) => {\n        if (!includeEvent) args = args.slice(1);\n        return fn.bind(bind)(...args);\n      });\n  }\n}\n","import { app, webContents } from 'electron';\nimport { parse } from 'url';\nimport { EventEmitter } from 'events';\nimport { PROTOCOL_SCHEME } from '../constants';\nimport { isBackgroundPage } from '../utils/web-contents';\n\nexport const sendToExtensionPages = (channel: string, ...args: any[]) => {\n  webContents.getAllWebContents().forEach((wc) => {\n    if (wc.isDestroyed() || !wc.getURL().startsWith(PROTOCOL_SCHEME)) return;\n    wc.send(channel, ...args);\n  });\n};\n\nexport declare interface BackgroundPages {\n  on(\n    event: 'created',\n    listener: (webContents: Electron.WebContents) => void,\n  ): this;\n  on(event: string, listener: Function): this;\n}\n\nexport class BackgroundPages extends EventEmitter {\n  public constructor() {\n    super();\n\n    app.on('web-contents-created', (e, wc) => {\n      if (isBackgroundPage(wc)) {\n        this.emit('created', webContents);\n      }\n    });\n  }\n\n  public get(extensionId: string, session: Electron.Session) {\n    return webContents\n      .getAllWebContents()\n      .find(\n        (x) =>\n          isBackgroundPage(x) &&\n          parse(x.getURL()).hostname === extensionId &&\n          x.session === session,\n      );\n  }\n}\n","module.exports = require(\"events\");","import { CookiesAPI } from './cookies';\nimport { TabsAPI } from './tabs';\nimport { BackgroundPages } from './background-pages';\nimport { WindowsAPI } from './windows';\nimport { hookExtensionWebRequestBypass } from './web-request-electron';\nimport { WebRequestAPI } from './web-request-api';\nimport { BrowserActionAPI } from './browser-action';\n\nexport class Extensions {\n  public static instance = new Extensions();\n\n  public tabs = new TabsAPI();\n  public cookies = new CookiesAPI();\n  public windows = new WindowsAPI();\n  public webRequest = new WebRequestAPI();\n  public browserAction = new BrowserActionAPI();\n\n  public backgroundPages = new BackgroundPages();\n\n  public initializeSession(session: Electron.Session, preloadPath: string) {\n    if (session.getPreloads().includes(preloadPath)) {\n      throw new Error(\n        'Extension preload has already been injected into this Session.',\n      );\n    }\n    session.setPreloads(session.getPreloads().concat(preloadPath));\n\n    hookExtensionWebRequestBypass(session);\n    this.cookies.observeSession(session);\n  }\n}\n\nexport const extensions = Extensions.instance;\n\nexport * from '../utils/session';\n","import { PROTOCOL_SCHEME } from '../constants';\nimport { randomId } from './string';\nimport { ipcMain } from 'electron';\n\n// TODO: https://github.com/electron/electron/pull/22217\nexport const isBackgroundPage = (wc: Electron.WebContents) =>\n  // TODO: wc.getType() === 'backgroundPage';\n  wc.getType() === 'remote' && wc.getURL().startsWith(PROTOCOL_SCHEME);\n\nexport const webContentsInvoke = (\n  wc: Electron.WebContents,\n  channel: string,\n  ...args: any[]\n): Promise<any> =>\n  new Promise((resolve) => {\n    const id = randomId();\n\n    ipcMain.once(`${channel}-${id}`, (e: any, ...a: any[]) => resolve(...a));\n\n    wc.send(channel, ...args, id);\n  });\n","import { v4 as uuidv4 } from 'uuid';\n\nexport const randomId = () => uuidv4();\n","module.exports = require(\"path\");","import { Session } from 'electron';\n\nimport { matchesPattern } from './url';\nimport { randomId } from './string';\n\ntype WebRequestWithCallback =\n  | 'onBeforeRequest'\n  | 'onBeforeSendHeaders'\n  | 'onHeadersReceived';\n\ntype WebRequestWithoutCallback =\n  | 'onSendHeaders'\n  | 'onResponseStarted'\n  | 'onBeforeRedirect'\n  | 'onCompleted'\n  | 'onErrorOccurred';\n\nexport type WebRequestMethod =\n  | WebRequestWithCallback\n  | WebRequestWithoutCallback;\nexport type URLPattern = string;\n\nexport interface IFilter {\n  urls: string[];\n}\n\nexport interface IListener {\n  id: string;\n  urls: string[];\n  action: Function;\n  context: IContext;\n}\n\nexport interface IContext {\n  priority?: number;\n  origin?: string;\n  order: number;\n}\n\nexport interface IApplier {\n  apply: Function;\n  context: IContext;\n}\n\nexport interface IAliasParameters {\n  unbind: boolean;\n  filter: IFilter;\n  action: Function | null;\n  context: Record<string, any>;\n}\n\nexport type IListenerCollection = Map<IListener['id'], IListener>;\n\nconst defaultResolver = (listeners: IApplier[]) => {\n  const response = listeners\n    .sort((a, b) => b.context.order - a.context.order)\n    .reduce(\n      async (accumulator: any, element: any) => {\n        if (accumulator.cancel) {\n          return accumulator;\n        }\n\n        const result = await element.apply();\n\n        return { ...accumulator, ...result };\n      },\n      { cancel: false },\n    );\n\n  return response;\n};\n\nconst methodsWithCallback = [\n  'onBeforeRequest',\n  'onBeforeSendHeaders',\n  'onHeadersReceived',\n];\n\nconst aliasMethods = [\n  'onBeforeRequest',\n  'onBeforeSendHeaders',\n  'onHeadersReceived',\n  'onSendHeaders',\n  'onResponseStarted',\n  'onBeforeRedirect',\n  'onCompleted',\n  'onErrorOccurred',\n];\n\nexport class BetterWebRequest {\n  public webRequest: any;\n\n  private orderIndex: number;\n  private listeners: Map<WebRequestMethod, IListenerCollection>;\n  private filters: Map<WebRequestMethod, Set<URLPattern>>;\n  private resolvers: Map<WebRequestMethod, Function>;\n\n  constructor(webRequest: any) {\n    this.orderIndex = 0;\n    this.webRequest = webRequest;\n    this.listeners = new Map();\n    this.filters = new Map();\n    this.resolvers = new Map();\n  }\n\n  private get nextIndex() {\n    return (this.orderIndex += 1);\n  }\n\n  getListeners() {\n    return this.listeners;\n  }\n\n  getListenersFor(method: WebRequestMethod) {\n    return this.listeners.get(method);\n  }\n\n  getFilters() {\n    return this.filters;\n  }\n\n  getFiltersFor(method: WebRequestMethod) {\n    return this.filters.get(method);\n  }\n\n  hasCallback(method: WebRequestMethod): boolean {\n    return methodsWithCallback.includes(method);\n  }\n\n  alias(method: WebRequestMethod, parameters: any) {\n    const args = this.parseArguments(parameters);\n    return this.identifyAction(method, args);\n  }\n\n  addListener(\n    method: WebRequestMethod,\n    filter: IFilter,\n    action: Function,\n    outerContext: Partial<IContext> = {},\n  ) {\n    const { urls } = filter;\n    const id = randomId();\n    const innerContext = { order: this.nextIndex };\n    const context = { ...outerContext, ...innerContext };\n    const listener = {\n      id,\n      urls,\n      action,\n      context,\n    };\n\n    if (!this.listeners.has(method)) {\n      this.listeners.set(method, new Map());\n    }\n\n    this.listeners.get(method)!.set(id, listener);\n\n    if (!this.filters.has(method)) {\n      this.filters.set(method, new Set());\n    }\n\n    const currentFilters = this.filters.get(method)!;\n    for (const url of urls) {\n      currentFilters.add(url);\n    }\n\n    this.webRequest[method](\n      { urls: [...currentFilters] },\n      this.listenerFactory(method),\n    );\n\n    return listener;\n  }\n\n  removeListener(method: WebRequestMethod, id: IListener['id']) {\n    const listeners = this.listeners.get(method);\n\n    if (!listeners || !listeners.has(id)) {\n      return;\n    }\n\n    if (listeners.size === 1) {\n      this.clearListeners(method);\n    } else {\n      listeners.delete(id);\n\n      const newFilters = this.mergeFilters(listeners);\n      this.filters.set(method, newFilters);\n\n      this.webRequest[method](\n        { urls: [...newFilters] },\n        this.listenerFactory(method),\n      );\n    }\n  }\n\n  clearListeners(method: WebRequestMethod) {\n    const listeners = this.listeners.get(method);\n    const filters = this.filters.get(method);\n\n    if (listeners) listeners.clear();\n    if (filters) filters.clear();\n\n    this.webRequest[method](null);\n  }\n\n  setResolver(method: WebRequestMethod, resolver: Function) {\n    if (!this.hasCallback(method)) {\n      console.warn(\n        `Event method \"${method}\" has no callback and does not use a resolver`,\n      );\n      return;\n    }\n\n    this.resolvers.set(method, resolver);\n  }\n\n  matchListeners(url: string, listeners: IListenerCollection): IListener[] {\n    const arrayListeners = Array.from(listeners.values());\n\n    return arrayListeners.filter((element) =>\n      element.urls.some((value) => matchesPattern(value, url)),\n    );\n  }\n\n  private listenerFactory(method: WebRequestMethod) {\n    return async (details: any, callback?: Function) => {\n      if (!this.listeners.has(method)) {\n        this.webRequest[method](null);\n        return;\n      }\n\n      const listeners = this.listeners.get(method);\n\n      if (!listeners) {\n        if (callback) callback({ cancel: false });\n        return;\n      }\n\n      const matchedListeners = this.matchListeners(details.url, listeners);\n\n      if (matchedListeners.length === 0) {\n        if (callback) callback({ cancel: false });\n        return;\n      }\n\n      let resolve = this.resolvers.get(method);\n\n      if (!resolve) {\n        resolve = defaultResolver;\n      }\n\n      const requestsProcesses = this.processRequests(details, matchedListeners);\n\n      if (this.hasCallback(method) && callback) {\n        const modified = await resolve(requestsProcesses);\n        callback(modified);\n      } else {\n        requestsProcesses.map((listener) => listener.apply());\n      }\n    };\n  }\n\n  private processRequests(\n    details: any,\n    requestListeners: IListener[],\n  ): IApplier[] {\n    const appliers: IApplier[] = [];\n\n    for (const listener of requestListeners) {\n      const apply = this.makeApplier(details, listener.action);\n\n      appliers.push({\n        apply,\n        context: listener.context,\n      });\n    }\n\n    return appliers;\n  }\n\n  private makeApplier(details: any, listener: Function): Function {\n    return () =>\n      new Promise((resolve, reject) => {\n        try {\n          listener(details, resolve);\n        } catch (err) {\n          reject(err);\n        }\n      });\n  }\n\n  private mergeFilters(listeners: IListenerCollection): Set<any> {\n    const arrayListeners = Array.from(listeners.values());\n\n    return arrayListeners.reduce((accumulator, value) => {\n      for (const url of value.urls) accumulator.add(url);\n      return accumulator;\n    }, new Set());\n  }\n\n  private parseArguments(parameters: any): IAliasParameters {\n    const args = {\n      unbind: false,\n      filter: { urls: ['<all_urls>'] },\n      action: null as any,\n      context: {},\n    };\n\n    switch (parameters.length) {\n      case 0:\n        args.unbind = true;\n        break;\n\n      case 1:\n        if (typeof parameters[0] === 'function') {\n          args.action = parameters[0];\n          break;\n        }\n\n        throw new Error(\n          'Wrong function signature : No function listener given',\n        );\n\n      case 2:\n        if (\n          typeof parameters[0] === 'object' &&\n          typeof parameters[1] === 'function'\n        ) {\n          args.filter = parameters[0];\n          args.action = parameters[1];\n          break;\n        }\n\n        if (typeof parameters[0] === 'function') {\n          args.action = parameters[0];\n          args.context = parameters[1];\n          break;\n        }\n\n        throw new Error(\n          'Wrong function signature : argument 1 should be an object filters or the function listener',\n        );\n\n      case 3:\n        if (\n          typeof parameters[0] === 'object' &&\n          typeof parameters[1] === 'function'\n        ) {\n          args.filter = parameters[0];\n          args.action = parameters[1];\n          args.context = parameters[2];\n          break;\n        }\n\n        throw new Error(\n          'Wrong function signature : should be arg 1 -> filter object, arg 2 -> function listener, arg 3 -> context',\n        );\n\n      default:\n        throw new Error('Wrong function signature : Too many arguments');\n    }\n\n    return args;\n  }\n\n  private identifyAction(method: WebRequestMethod, args: IAliasParameters) {\n    const { unbind, filter, action, context } = args;\n\n    if (unbind) {\n      return this.clearListeners(method);\n    }\n\n    if (!action) {\n      throw new Error(`Cannot bind with ${method} : a listener is missing.`);\n    }\n\n    return this.addListener(method, filter, action, context);\n  }\n}\n\nconst aliasHandler = {\n  get: (target: BetterWebRequest, property: any) => {\n    if (aliasMethods.includes(property)) {\n      return (...parameters: any) => {\n        target.alias(property, parameters);\n      };\n    }\n\n    return (target as any)[property];\n  },\n};\n\nconst betterWebRequest = (session: Session) => {\n  return new Proxy(new BetterWebRequest(session.webRequest), aliasHandler);\n};\n\nconst store = new Set();\n\nconst extendElectronWebRequest = (session: Session): Session => {\n  if (store.has(session)) {\n    return session;\n  }\n\n  Object.defineProperty(session, 'webRequest', {\n    value: betterWebRequest(session),\n    writable: false,\n  });\n\n  store.add(session);\n\n  return session;\n};\n\nexport default extendElectronWebRequest;\n","export * from './browser';\n","import { sessionFromIpcEvent } from '../utils/session';\nimport { HandlerFactory } from './handler-factory';\nimport { sendToExtensionPages } from './background-pages';\n\nconst ELECTRON_TO_CHROME_COOKIE_CHANGE_CAUSE: { [key: string]: string } = {\n  explicit: 'explicit',\n  overwrite: 'overwrite',\n  expired: 'expired',\n  evicted: 'evicted',\n  'expired-overwrite': 'expired_overwrite',\n};\n\nexport class CookiesAPI {\n  constructor() {\n    const handler = HandlerFactory.create('cookies', this);\n\n    handler('get', this.get, true);\n    handler('getAll', this.getAll, true);\n    handler('set', this.set, true);\n    handler('remove', this.remove, true);\n  }\n\n  public observeSession(ses: Electron.Session) {\n    ses.cookies.on(\n      'changed',\n      (e: any, electronCookie: any, electronCause: any, removed: any) => {\n        const cookie = this.getChromeCookie(electronCookie);\n        const cause = ELECTRON_TO_CHROME_COOKIE_CHANGE_CAUSE[electronCause];\n\n        const details = {\n          cookie,\n          cause,\n          removed,\n        };\n\n        sendToExtensionPages('cookies.onChanged', details);\n      },\n    );\n  }\n\n  private getChromeCookie(cookie: Electron.Cookie): chrome.cookies.Cookie {\n    return {\n      name: cookie.name,\n      value: cookie.value,\n      domain: cookie.domain,\n      hostOnly: cookie.hostOnly,\n      path: cookie.path,\n      secure: cookie.secure,\n      httpOnly: cookie.httpOnly,\n      sameSite: 'no_restriction',\n      session: cookie.session,\n      expirationDate: cookie.expirationDate,\n      storeId: '0',\n    };\n  }\n\n  private async getAll(\n    e: Electron.IpcMainEvent,\n    details: chrome.cookies.Cookie & { url: string },\n  ) {\n    const { url, name, domain, path, secure, session } = details;\n\n    const cookies = await sessionFromIpcEvent(e).cookies.get({\n      url,\n      name,\n      domain,\n      path,\n      secure,\n      session,\n    });\n\n    if (cookies) {\n      return cookies.map((c) => this.getChromeCookie(c));\n    }\n\n    return [];\n  }\n\n  private async get(e: Electron.IpcMainEvent, details: chrome.cookies.Details) {\n    const { url, name } = details;\n\n    const cookies = await sessionFromIpcEvent(e).cookies.get({ url, name });\n\n    if (cookies && cookies[0]) {\n      const cookie = cookies[0];\n      return this.getChromeCookie(cookie);\n    }\n\n    return null;\n  }\n\n  private async set(\n    e: Electron.IpcMainEvent,\n    details: { url: string } & Partial<chrome.cookies.Cookie>,\n  ): Promise<Partial<chrome.cookies.Cookie>> {\n    const {\n      url,\n      name,\n      value,\n      domain,\n      path,\n      secure,\n      httpOnly,\n      expirationDate,\n    } = details;\n\n    await sessionFromIpcEvent(e).cookies.set({\n      url,\n      name,\n      value,\n      domain,\n      path,\n      secure,\n      httpOnly,\n      expirationDate,\n    });\n\n    return {\n      name,\n      value,\n      domain,\n      path,\n      secure,\n      httpOnly,\n      expirationDate,\n      storeId: null,\n    };\n  }\n\n  private async remove(\n    e: Electron.IpcMainEvent,\n    details: chrome.cookies.Details,\n  ): Promise<Partial<chrome.cookies.Cookie & { url: string }>> {\n    const { url, name } = details;\n\n    await sessionFromIpcEvent(e).cookies.remove(url, name);\n    return { url, name, storeId: null };\n  }\n}\n","module.exports = require(\"url\");","import { Tab } from '../interfaces/tabs';\nimport { BrowserWindow } from 'electron';\nimport { promises } from 'fs';\nimport { resolve } from 'path';\nimport { sessionFromIpcEvent } from '../utils/session';\nimport { sendToExtensionPages } from './background-pages';\nimport { EventEmitter } from 'events';\nimport { Extensions } from '.';\nimport { HandlerFactory } from './handler-factory';\n\nexport const getParentWindowOfTab = (tab: Tab) => {\n  switch (tab.getType()) {\n    case 'window':\n      return BrowserWindow.fromWebContents(tab);\n    case 'browserView':\n    case 'webview':\n      return (tab as any).getOwnerBrowserWindow();\n  }\n  return undefined;\n};\n\n// Events which can be registered only once\ninterface ITabsEvents {\n  onCreateDetails: (tab: Tab, details: chrome.tabs.Tab) => void;\n  onCreate: (details: chrome.tabs.CreateProperties) => Promise<number>;\n}\n\nexport declare interface TabsAPI {\n  on(\n    event: 'updated',\n    listener: (\n      tabId: number,\n      changeInfo: chrome.tabs.TabChangeInfo,\n      details: chrome.tabs.Tab,\n    ) => void,\n  ): this;\n  on(\n    event: 'activated',\n    listener: (\n      tabId: number,\n      windowId: number,\n      ...additionalArgs: any[]\n    ) => void,\n  ): this;\n  on(event: 'will-remove', listener: (tabId: number) => void): this;\n  on(event: string, listener: Function): this;\n}\n\ntype DetailsType = chrome.tabs.Tab & { [key: string]: string };\n\nexport class TabsAPI extends EventEmitter implements ITabsEvents {\n  private tabs: Set<Tab> = new Set();\n  private detailsCache: Map<Tab, chrome.tabs.Tab> = new Map();\n\n  constructor() {\n    super();\n\n    const handler = HandlerFactory.create('tabs', this);\n\n    handler('get', this.get);\n    handler('getSelected', this.getSelected);\n    handler('getAllInWindow', this.getAllInWindow);\n    handler('query', this.query);\n    handler('update', this.update);\n    handler('reload', this.reload);\n    handler('create', this.create);\n    handler('remove', this.remove);\n\n    handler('getCurrent', this.getCurrent, true);\n    handler('insertCSS', this.insertCSS, true);\n  }\n\n  onCreateDetails: (tab: Tab, details: chrome.tabs.Tab) => void;\n  onCreate: (details: chrome.tabs.CreateProperties) => Promise<number>;\n\n  public async update(\n    tabId: number,\n    updateProperties: chrome.tabs.UpdateProperties,\n  ) {\n    const tab = this.getTabById(tabId);\n    if (!tab) return null;\n\n    const { url, muted, active } = updateProperties;\n\n    // TODO: validate URL, prevent 'javascript:'\n    if (url) await tab.loadURL(url);\n\n    if (typeof muted === 'boolean') tab.setAudioMuted(muted);\n\n    if (active) this.activate(tabId);\n\n    this.onUpdated(tab);\n\n    return this.createDetails(tab);\n  }\n\n  public activate(tabId: number, ...additionalArgs: any[]) {\n    const tab = this.getTabById(tabId);\n    if (!tab) return;\n\n    const details = this.getDetails(tab);\n\n    const activeChanged = !details.active;\n\n    this.detailsCache.forEach((tabInfo, cacheTab) => {\n      tabInfo.active = tabId === cacheTab.id;\n    });\n\n    if (!activeChanged) return;\n\n    this.emit('activated', tab.id, details.windowId, ...additionalArgs);\n    sendToExtensionPages('tabs.onActivated', {\n      tabId,\n      windowId: details.windowId,\n    });\n  }\n\n  public get(tabId: number): chrome.tabs.Tab {\n    const tab = this.getTabById(tabId);\n    return this.getDetails(tab);\n  }\n\n  public remove(tabIds: number | number[]) {\n    if (Array.isArray(tabIds)) {\n      tabIds.forEach((id) => this.emit('will-remove', id));\n      return;\n    }\n\n    this.emit('will-remove', tabIds);\n  }\n\n  // This API is deprecated, so we fallback it to chrome.tabs.query({ windowId })\n  public getAllInWindow(windowId: number) {\n    return this.query({ windowId });\n  }\n\n  // Deprecated, fallback to chrome.tabs.query\n  public getSelected(windowId: number) {\n    if (typeof windowId === 'number') {\n      return this.query({ windowId, active: true });\n    }\n    return this.query({ active: true });\n  }\n\n  public query(info: chrome.tabs.QueryInfo = {}) {\n    const isSet = (value: any) => typeof value !== 'undefined';\n\n    const tabs = Array.from(this.tabs)\n      .map(this.getDetails)\n      .filter((tab) => {\n        if (isSet(info.active) && info.active !== tab.active) return false;\n        if (isSet(info.pinned) && info.pinned !== tab.pinned) return false;\n        if (isSet(info.audible) && info.audible !== tab.audible) return false;\n        if (isSet(info.muted) && info.muted !== tab.mutedInfo.muted)\n          return false;\n        if (isSet(info.highlighted) && info.highlighted !== tab.highlighted)\n          return false;\n        if (isSet(info.discarded) && info.discarded !== tab.discarded)\n          return false;\n        if (\n          isSet(info.autoDiscardable) &&\n          info.autoDiscardable !== tab.autoDiscardable\n        )\n          return false;\n        if (isSet(info.status) && info.status !== tab.status) return false;\n        if (isSet(info.windowId) && info.windowId !== tab.windowId)\n          return false;\n        if (isSet(info.title) && info.title !== tab.title) return false; // TODO: pattern match\n        if (\n          isSet(info.url) &&\n          info.url !== tab.url &&\n          info.url !== '<all_urls>'\n        )\n          return false; // TODO: match URL pattern\n        // if (isSet(info.currentWindow)) return false\n        // if (isSet(info.lastFocusedWindow)) return false\n        // if (isSet(info.windowType) && info.windowType !== tab.windowType) return false\n        // if (isSet(info.index) && info.index !== tab.index) return false\n        return true;\n      })\n      .map((tab, index) => {\n        tab.index = index;\n        return tab;\n      });\n\n    return tabs;\n  }\n\n  public async create(\n    details: chrome.tabs.CreateProperties,\n  ): Promise<chrome.tabs.Tab> {\n    if (!this.onCreate) {\n      throw new Error('No onCreate event handler');\n    }\n\n    const tabId = await this.onCreate(details);\n    const tab = this.getTabById(tabId);\n    return this.getDetails(tab);\n  }\n\n  public observe(tab: Tab) {\n    this.tabs.add(tab);\n\n    tab.once('destroyed', () => {\n      this.tabs.delete(tab);\n      this.onRemoved(tab);\n    });\n\n    const updateEvents: any[] = [\n      'page-title-updated', // title\n      'did-start-loading', // status\n      'did-stop-loading', // status\n      'media-started-playing', // audible\n      'media-paused', // audible\n      'did-start-navigation', // url\n      'did-redirect-navigation', // url\n      'did-navigate-in-page', // url\n    ];\n\n    updateEvents.forEach((eventName) => {\n      tab.on(eventName, () => {\n        this.onUpdated(tab);\n      });\n    });\n\n    tab.on('page-favicon-updated', (event, favicons) => {\n      tab.favicon = favicons[0];\n      this.onUpdated(tab);\n    });\n\n    this.onCreated(tab);\n  }\n\n  public reload(\n    tabId: number,\n    reloadProperties: chrome.tabs.ReloadProperties = {},\n  ) {\n    const tab = this.getTabById(tabId);\n    if (!tab) return;\n\n    if (reloadProperties.bypassCache) {\n      tab.reloadIgnoringCache();\n    } else {\n      tab.reload();\n    }\n  }\n\n  public getTabById(id: number) {\n    return Array.from(this.tabs).find((x) => x.id === id);\n  }\n\n  public getDetails = (tab: Tab): chrome.tabs.Tab => {\n    if (!tab) return null;\n\n    if (this.detailsCache.has(tab)) {\n      return this.detailsCache.get(tab);\n    }\n\n    return this.createDetails(tab);\n  };\n\n  private getCurrent(e: Electron.IpcMainInvokeEvent) {\n    const tab = this.getTabById(e.sender.id);\n    if (!tab) return null;\n\n    return this.getDetails(tab);\n  }\n\n  private async insertCSS(\n    e: Electron.IpcMainEvent,\n    extensionId: string,\n    tabId: number,\n    details: chrome.tabs.InjectDetails,\n  ) {\n    const tab = this.getTabById(tabId);\n    if (!tab) return;\n\n    if (details.hasOwnProperty('file')) {\n      const ses = sessionFromIpcEvent(e);\n      details.code = await promises.readFile(\n        resolve(ses.getExtension(extensionId).path, details.file),\n        'utf8',\n      );\n    }\n\n    tab.insertCSS(details.code, {\n      cssOrigin: details.cssOrigin,\n    });\n  }\n\n  private createDetails(tab: Tab): chrome.tabs.Tab {\n    const window = getParentWindowOfTab(tab);\n    const [width = 0, height = 0] = window ? window.getSize() : [];\n\n    const prevDetails: Partial<chrome.tabs.Tab> = this.detailsCache.get(\n      tab,\n    ) || {\n      id: tab.id,\n      active: false,\n      highlighted: false,\n      selected: false,\n      autoDiscardable: true,\n      discarded: false,\n      incognito: false,\n      index: 0,\n      pinned: false,\n    };\n\n    const details: chrome.tabs.Tab = {\n      ...(prevDetails as chrome.tabs.Tab),\n      audible: tab.isCurrentlyAudible(),\n      favIconUrl: tab.favicon || undefined,\n      height,\n      width,\n      mutedInfo: { muted: tab.audioMuted },\n      status: tab.isLoading() ? 'loading' : 'complete',\n      title: tab.getTitle(),\n      url: tab.getURL(),\n      windowId: window ? window.id : -1,\n    };\n\n    if (this.onCreateDetails) this.onCreateDetails(tab, details);\n\n    this.detailsCache.set(tab, details);\n\n    return details;\n  }\n\n  private onUpdated(tab: Tab) {\n    if (!tab) return;\n\n    const prevDetails: DetailsType = this.detailsCache.get(tab) as any;\n    if (!prevDetails) return;\n\n    const details: DetailsType = this.createDetails(tab) as any;\n\n    const compareProps = [\n      'status',\n      'url',\n      'pinned',\n      'audible',\n      'discarded',\n      'autoDiscardable',\n      'mutedInfo',\n      'favIconUrl',\n      'title',\n    ];\n\n    let didUpdate = false;\n    const changeInfo: any = {};\n\n    for (const prop of compareProps) {\n      if (details[prop] !== prevDetails[prop]) {\n        changeInfo[prop] = details[prop];\n        didUpdate = true;\n      }\n    }\n\n    if (!didUpdate) return;\n\n    this.emit('updated', tab.id, changeInfo, details);\n    sendToExtensionPages('tabs.onUpdated', tab.id, changeInfo, details);\n  }\n\n  private onRemoved(tab: Tab) {\n    const details = this.detailsCache.has(tab)\n      ? this.detailsCache.get(tab)\n      : null;\n\n    this.detailsCache.delete(tab);\n\n    const windowId = details ? details.windowId : -1;\n    const win = Extensions.instance.windows.getWindowById(windowId);\n\n    sendToExtensionPages('tabs.onRemoved', tab.id, {\n      windowId,\n      isWindowClosing: win ? win.isDestroyed() : false,\n    });\n  }\n\n  private onCreated(tab: Tab) {\n    const details = this.getDetails(tab);\n    sendToExtensionPages('tabs.onCreated', details);\n  }\n}\n","module.exports = require(\"fs\");","import { BrowserWindow } from 'electron';\nimport { EventEmitter } from 'events';\nimport { Extensions } from '.';\nimport { isBackgroundPage } from '../utils/web-contents';\nimport { WINDOW_ID_CURRENT } from '../constants';\nimport { sendToExtensionPages } from './background-pages';\nimport { HandlerFactory } from './handler-factory';\n\n// Events which can be registered only once\ninterface IWindowsEvents {\n  onCreateDetails: (\n    window: BrowserWindow,\n    details: chrome.windows.Window,\n  ) => void;\n  onBeforeFocusNextZOrder: (windowId: number) => number;\n  onCreate: (details: chrome.windows.CreateData) => Promise<number>;\n}\n\nexport declare interface WindowsAPI {\n  on(event: 'focused', listener: (windowId: number) => void): this;\n  on(event: 'created', listener: (window: chrome.windows.Window) => void): this;\n  on(event: 'will-remove', listener: (windowId: number) => void): this;\n  on(event: string, listener: Function): this;\n}\n\nexport class WindowsAPI extends EventEmitter implements IWindowsEvents {\n  private windows: Set<BrowserWindow> = new Set();\n\n  private detailsCache: Map<BrowserWindow, chrome.windows.Window> = new Map();\n\n  private lastFocused: BrowserWindow;\n\n  constructor() {\n    super();\n\n    const handler = HandlerFactory.create('windows', this);\n\n    handler('create', this.create);\n    handler('update', this.update);\n    handler('getAll', this.getAll);\n    handler('getLastFocused', this.getLastFocused);\n\n    handler('get', this.getHandler, true);\n    handler('getCurrent', this.getCurrent, true);\n  }\n\n  onBeforeFocusNextZOrder: (windowId: number) => number;\n  onCreateDetails: (\n    window: BrowserWindow,\n    details: chrome.windows.Window,\n  ) => void;\n  onCreate: (details: chrome.windows.CreateData) => Promise<number>;\n\n  public update(windowId: number, updateInfo: chrome.windows.UpdateInfo) {\n    const win = this.getWindowById(windowId);\n    if (!win) return null;\n\n    const { left, top, width, height, state } = updateInfo;\n\n    if (!['minimized', 'maximized', 'fullscreen'].includes(state)) {\n      const bounds = win.getBounds();\n      const newBounds: Electron.Rectangle = { ...bounds };\n\n      if (!isNaN(left)) newBounds.x = Math.floor(left);\n      if (!isNaN(top)) newBounds.y = Math.floor(top);\n      if (!isNaN(width) && width > 0) newBounds.width = Math.floor(width);\n      if (!isNaN(height) && height > 0) newBounds.height = Math.floor(height);\n\n      if (bounds !== newBounds) {\n        win.setBounds(newBounds);\n      }\n    }\n\n    if (typeof updateInfo.drawAttention === 'boolean') {\n      win.flashFrame(updateInfo.drawAttention && !win.isFocused());\n    }\n\n    if (typeof updateInfo.focused === 'boolean') {\n      if (updateInfo.focused) {\n        if (state !== 'minimized') win.focus();\n      } else if (\n        this.onBeforeFocusNextZOrder &&\n        !['fullscreen', 'maximized'].includes(state)\n      ) {\n        const windowIdToFocus = this.onBeforeFocusNextZOrder(windowId);\n        this.focus(windowIdToFocus);\n      }\n    }\n\n    if (state === 'minimized') win.minimize();\n    else if (state === 'maximized') win.maximize();\n    else if (state === 'fullscreen') win.setFullScreen(true);\n    else if (state === 'normal') {\n      if (win.isFullScreen()) win.setFullScreen(false);\n      if (win.isMinimized()) win.restore();\n      if (win.isMaximized()) win.unmaximize();\n    }\n\n    return this.createDetails(win);\n  }\n\n  public focus(windowId: number) {\n    const win = this.getWindowById(windowId);\n    win.focus();\n  }\n\n  public remove(windowId: number) {\n    this.emit('will-remove', windowId);\n  }\n\n  public observe(window: BrowserWindow) {\n    this.windows.add(window);\n\n    window.once('closed', () => {\n      this.windows.delete(window);\n      this.onRemoved(window);\n    });\n\n    window.on('focus', () => {\n      this.lastFocused = window;\n    });\n\n    this.onCreated(window);\n  }\n\n  public getWindowById(id: number) {\n    return Array.from(this.windows).find((x) => x.id === id);\n  }\n\n  public async create(\n    details: chrome.windows.CreateData,\n  ): Promise<chrome.windows.Window> {\n    if (!this.onCreate) {\n      throw new Error('No onCreate event handler');\n    }\n\n    const id = await this.onCreate(details);\n    const win = this.getWindowById(id);\n    return this.getDetails(win);\n  }\n\n  public getLastFocused(\n    getInfo: chrome.windows.GetInfo,\n  ): chrome.windows.Window {\n    return this.getDetailsMatchingGetInfo(this.lastFocused, getInfo);\n  }\n\n  public get(\n    id: number,\n    getInfo: chrome.windows.GetInfo,\n  ): chrome.windows.Window {\n    const win = this.getWindowById(id);\n    return this.getDetailsMatchingGetInfo(win, getInfo);\n  }\n\n  public getAll(getInfo: chrome.windows.GetInfo): chrome.windows.Window[] {\n    return Array.from(this.windows)\n      .map((win) => this.getDetailsMatchingGetInfo(win, getInfo))\n      .filter(Boolean);\n  }\n\n  private getHandler(\n    event: Electron.IpcMainInvokeEvent,\n    id: number,\n    details: any,\n  ) {\n    return id === WINDOW_ID_CURRENT\n      ? this.getCurrent(event, details)\n      : this.get(id, details);\n  }\n\n  private getCurrent = (\n    event: Electron.IpcMainInvokeEvent,\n    getInfo: chrome.windows.GetInfo,\n  ): chrome.windows.Window => {\n    const tab = Extensions.instance.tabs.getTabById(event.sender.id);\n\n    if (!tab) {\n      if (isBackgroundPage(event.sender)) {\n        return this.getDetailsMatchingGetInfo(this.lastFocused, getInfo);\n      }\n      return null;\n    }\n\n    const tabDetails = Extensions.instance.tabs.getDetails(tab);\n    const win = this.getWindowById(tabDetails.windowId);\n\n    return this.getDetailsMatchingGetInfo(win, getInfo);\n  };\n\n  private createDetails(win: BrowserWindow): chrome.windows.Window {\n    const { x, y, width, height } = win.getBounds();\n\n    let state = 'normal';\n\n    if (win.isFullScreen()) state = 'fullscreen';\n    else if (win.isMaximized()) state = 'maximized';\n    else if (win.isMinimized()) state = 'minimized';\n\n    const details: chrome.windows.Window = {\n      id: win.id,\n      focused: win.isFocused(),\n      top: y,\n      left: x,\n      width,\n      height,\n      incognito: false,\n      type: 'normal',\n      state,\n      alwaysOnTop: win.isAlwaysOnTop(),\n    };\n\n    if (this.onCreateDetails) this.onCreateDetails(win, details);\n\n    this.detailsCache.set(win, details);\n\n    return details;\n  }\n\n  private getDetails(win: BrowserWindow): chrome.windows.Window {\n    if (!win) return null;\n\n    if (this.detailsCache.has(win)) {\n      return this.detailsCache.get(win);\n    }\n\n    return this.createDetails(win);\n  }\n\n  private getDetailsMatchingGetInfo = (\n    win: BrowserWindow,\n    getInfo: chrome.windows.GetInfo,\n  ): chrome.windows.Window => {\n    if (!win) return null;\n\n    const details = this.getDetails(win);\n\n    let windowTypes = getInfo?.windowTypes;\n\n    if (!Array.isArray(windowTypes)) {\n      windowTypes = ['normal', 'popup'];\n    }\n\n    if (!windowTypes.includes(details.type)) return null;\n\n    if (getInfo?.populate === true) {\n      return {\n        ...details,\n        tabs: Extensions.instance.tabs.query({ windowId: win.id }),\n      };\n    }\n\n    return details;\n  };\n\n  private onRemoved(win: BrowserWindow) {\n    this.emit('will-remove', win.id);\n    sendToExtensionPages('windows.onRemoved', {\n      windowId: win.id,\n    });\n  }\n\n  private onCreated(win: BrowserWindow) {\n    const details = this.getDetails(win);\n    this.emit('created', details);\n    sendToExtensionPages('windows.onCreated', details);\n  }\n}\n","import { webContents } from 'electron';\nimport extendElectronWebRequest from '../utils/web-request';\nimport { PROTOCOL_SCHEME } from '../constants';\n\nconst requestIsOption = (details: any) => {\n  const { method } = details;\n\n  return method === 'OPTIONS';\n};\n\nconst requestIsFromBackgroundPage = (details: any): boolean => {\n  const { webContentsId } = details;\n\n  if (webContentsId) {\n    const wc = webContents.fromId(webContentsId);\n\n    if (wc) {\n      return wc.getURL().startsWith(PROTOCOL_SCHEME);\n    }\n\n    return false;\n  }\n\n  return false;\n};\n\nconst requestsOrigins = new Map<number, string>();\n\nconst requestIsXhrOrSubframe = (details: any) => {\n  const { resourceType } = details;\n\n  const isXhr = resourceType === 'xhr';\n  const isSubframe = resourceType === 'subFrame';\n\n  return isXhr || isSubframe;\n};\n\nconst requestHasExtensionOrigin = (details: any) => {\n  const { id } = details;\n\n  const origin = requestsOrigins.get(id);\n\n  if (origin) {\n    return origin.startsWith(PROTOCOL_SCHEME);\n  }\n\n  return false;\n};\n\nconst requestIsForExtension = (details: any) =>\n  requestHasExtensionOrigin(details) && requestIsXhrOrSubframe(details);\n\nexport const hookExtensionWebRequestBypass = (session: Electron.Session) => {\n  extendElectronWebRequest(session);\n\n  session.webRequest.onBeforeSendHeaders((details, callback) => {\n    requestsOrigins.set(details.id, details.requestHeaders.Origin);\n\n    if (\n      !requestIsFromBackgroundPage(details) &&\n      requestIsForExtension(details) &&\n      !requestIsOption(details)\n    ) {\n      return callback({\n        requestHeaders: {\n          ...details.requestHeaders,\n          Origin: null,\n        },\n      });\n    }\n\n    callback({ requestHeaders: details.requestHeaders });\n  });\n\n  session.webRequest.onHeadersReceived((details, callback) => {\n    for (const key in details.responseHeaders) {\n      const val = details.responseHeaders[key];\n      delete details.responseHeaders[key];\n      details.responseHeaders[key.toLowerCase()] = val;\n    }\n\n    const accessControlAllowOrigin =\n      details.responseHeaders['access-control-allow-origin'] || [];\n    const allowedOriginIsWildcard = accessControlAllowOrigin.includes('*');\n\n    details.responseHeaders['access-control-allow-credentials'] = ['true'];\n\n    if (requestIsForExtension(details) || allowedOriginIsWildcard) {\n      details.responseHeaders['access-control-allow-origin'] = [\n        requestsOrigins.get(details.id),\n      ];\n    }\n\n    requestsOrigins.delete(details.id);\n\n    callback({ responseHeaders: details.responseHeaders });\n  });\n};\n","export const matchesPattern = (pattern: string, url: string) => {\n  if (pattern === '<all_urls>') {\n    return true;\n  }\n\n  const regexp = new RegExp(\n    `^${pattern.replace(/\\*/g, '.*').replace('/', '\\\\/')}$`,\n  );\n  return url.match(regexp) != null;\n};\n","import { webContents, ipcMain } from 'electron';\nimport { sessionFromIpcEvent } from '../utils/session';\nimport { webContentsInvoke } from '../utils/web-contents';\nimport extendElectronWebRequest from '../utils/web-request';\n\nconst clearCacheOnNavigation = () => {\n  webContents.getAllWebContents().forEach((wc) => {\n    const onNavigation = true;\n    // TODO(sentialx): receive clear-cache in renderer\n    wc.send('clear-cache', onNavigation);\n  });\n};\n\nconst electronToChromeRequestType = (type: string): any => {\n  if (type === 'mainFrame') return 'main_frame';\n  if (type === 'subFrame') return 'sub_frame';\n  if (type === 'cspReport') return 'csp_report';\n  return type;\n};\n\nconst chromeToElectronHeaders = (headers: any) => {\n  const newHeaders: any = {};\n  headers.forEach((header: any) => (newHeaders[header.name] = [header.value]));\n  return newHeaders;\n};\n\nconst electronToChromeDetails = (details: any) => {\n  const newDetails = {\n    ...details,\n    requestId: details.id.toString(),\n    frameId: 0,\n    parentFrameId: -1,\n    type: electronToChromeRequestType(details.resourceType),\n    timeStamp: Date.now(),\n    tabId: details.webContentsId,\n    error: '',\n  };\n\n  if (newDetails.responseHeaders) {\n    newDetails.responseHeaders = Object.keys(newDetails.responseHeaders).map(\n      (k) => ({\n        name: k,\n        value: newDetails.responseHeaders[k][0],\n      }),\n    );\n  }\n\n  return newDetails;\n};\n\nexport class WebRequestAPI {\n  constructor() {\n    // TODO(sentialx): send clear-cache from renderer\n    ipcMain.on('clear-cache', () => {\n      clearCacheOnNavigation();\n    });\n\n    ipcMain.on('webRequest.addListener', this.addListener);\n  }\n\n  private addListener = (\n    e: Electron.IpcMainEvent,\n    listenerId: string,\n    name: string,\n    filter: any,\n  ) => {\n    const session = sessionFromIpcEvent(e);\n    const { webRequest }: any = extendElectronWebRequest(session);\n\n    // Ignore unknown webRequest event names.\n    if (!Object.getOwnPropertyNames(webRequest.webRequest).includes(name))\n      return;\n\n    clearCacheOnNavigation();\n\n    const { id }: any = webRequest.addListener(\n      name,\n      filter,\n      async (details: any, callback: any) => {\n        const returnedDetails = await webContentsInvoke(\n          e.sender,\n          listenerId,\n          electronToChromeDetails(details),\n        );\n\n        if (!returnedDetails) return callback(details);\n\n        if (returnedDetails.responseHeaders) {\n          returnedDetails.responseHeaders = chromeToElectronHeaders(\n            returnedDetails.responseHeaders,\n          );\n        }\n\n        return callback(returnedDetails);\n      },\n    );\n\n    ipcMain.on(`webRequest.removeListener-${listenerId}`, () => {\n      webRequest.removeListener(name, id);\n    });\n  };\n}\n","import { EventEmitter } from 'events';\nimport { sessionFromIpcEvent } from '../utils/session';\nimport { webContents } from 'electron';\nimport { isAbsolute } from 'path';\nimport { PROTOCOL_SCHEME } from '../constants';\nimport { HandlerFactory } from './handler-factory';\n\ntype IconType = string | { [key: string]: string };\n\ninterface IBrowserActionInfo {\n  icon?: IconType;\n  popup?: string;\n  title?: string;\n  badgeText?: string;\n  badgeBackgroundColor?: string | number[];\n}\n\ninterface IBrowserAction extends IBrowserActionInfo {\n  baseUrl: string;\n  extensionId: string;\n  tabs: Map<number, IBrowserActionInfo>;\n}\n\nconst CHROME_DETAILS_KEYS: { [key: string]: string } = {\n  badgeText: 'text',\n  badgeBackgroundColor: 'color',\n  title: 'title',\n};\n\nconst resolvePath = (extensionUrl: string, path: string) => {\n  if (!path) return undefined;\n  if (path.startsWith(extensionUrl) || isAbsolute(path)) return path;\n  return `${extensionUrl}${path}`;\n};\n\nconst resolveIconPaths = (extensionUrl: string, icon: IconType): IconType => {\n  if (typeof icon === 'object') {\n    const newIcon: IconType = {};\n    Object.entries(icon).forEach(([key, value]) => {\n      if (typeof value === 'string') {\n        newIcon[key] = resolvePath(extensionUrl, value);\n      }\n    });\n    return newIcon;\n  }\n\n  if (typeof icon === 'string') {\n    return resolvePath(extensionUrl, icon);\n  }\n\n  return undefined;\n};\n\nexport declare interface BrowserActionAPI {\n  on(event: 'updated', listener: (action: IBrowserAction) => void): this;\n  on(event: 'loaded', listener: (action: IBrowserAction) => void): this;\n  on(event: string, listener: Function): this;\n}\n\nexport class BrowserActionAPI extends EventEmitter {\n  private sessionActionMap: Map<\n    Electron.Session,\n    Map<string, IBrowserAction>\n  > = new Map();\n\n  constructor() {\n    super();\n\n    const setter = (propName: string) => (\n      e: Electron.IpcMainEvent,\n      extensionId: string,\n      details: chrome.browserAction.BadgeBackgroundColorDetails &\n        chrome.browserAction.BadgeTextDetails &\n        chrome.browserAction.TitleDetails &\n        chrome.browserAction.PopupDetails &\n        chrome.browserAction.TabIconDetails,\n    ) => {\n      const ses = sessionFromIpcEvent(e);\n      const action = this.getOrCreate(ses, extensionId);\n      const { tabId } = details;\n\n      let newValue: any = (details as any)[CHROME_DETAILS_KEYS[propName]];\n\n      if (propName === 'icon') {\n        newValue =\n          details.imageData || resolveIconPaths(action.baseUrl, details.path);\n      } else if (propName === 'popup') {\n        newValue = resolvePath(action.baseUrl, details.popup);\n      }\n\n      let actionToUpdate: any = action;\n\n      if (tabId) {\n        if (action.tabs.has(tabId)) {\n          actionToUpdate = action.tabs.get(tabId);\n        } else {\n          actionToUpdate = {};\n          action.tabs.set(tabId, actionToUpdate);\n        }\n      }\n\n      if (actionToUpdate[propName] !== newValue) {\n        actionToUpdate[propName] = newValue;\n        this.emit('updated', action);\n      }\n    };\n\n    const handler = HandlerFactory.create('browserAction', this);\n\n    [\n      'title',\n      'icon',\n      'popup',\n      'badgeBackgroundColor',\n      'badgeText',\n    ].forEach((prop) =>\n      handler(\n        `set${prop.charAt(0).toUpperCase()}${prop.substring(1)}`,\n        setter(prop),\n        true,\n      ),\n    );\n\n    handler('getAll', this.getAllHandler, true);\n\n    handler('getAllInTab', this.getAllInTab);\n    handler('onClicked', this.onClicked);\n  }\n\n  private getAllHandler(event: Electron.IpcMainEvent) {\n    return this.getAllInSession(sessionFromIpcEvent(event));\n  }\n\n  private getOrCreate(session: Electron.Session, extensionId: string) {\n    let sessionActions = this.sessionActionMap.get(session);\n    if (!sessionActions) {\n      sessionActions = new Map();\n      this.sessionActionMap.set(session, sessionActions);\n    }\n\n    let action = sessionActions.get(extensionId);\n    if (!action) {\n      action = {\n        tabs: new Map(),\n        extensionId,\n        baseUrl: `${PROTOCOL_SCHEME}${extensionId}/`,\n      };\n      sessionActions.set(extensionId, action);\n    }\n\n    return action;\n  }\n\n  public loadFromManifest(\n    session: Electron.Session,\n    extension: Electron.Extension,\n  ): IBrowserAction {\n    const { browser_action: browserAction } = extension.manifest || {};\n\n    if (!browserAction) return null;\n\n    const {\n      default_popup: popup,\n      default_title: title,\n      default_icon: icon,\n    } = browserAction;\n\n    const action = this.getOrCreate(session, extension.id);\n    Object.assign(action, {\n      popup: resolvePath(extension.url, popup),\n      icon: resolveIconPaths(extension.url, icon),\n      title,\n    });\n\n    this.emit('loaded', action);\n\n    return action;\n  }\n\n  public getAllInSession(session: Electron.Session): IBrowserAction[] {\n    const sessionActions = this.sessionActionMap.get(session);\n    if (!sessionActions) return [];\n    return Array.from(sessionActions.values());\n  }\n\n  public getAllInTab(tabId: number): IBrowserAction[] {\n    const tab = webContents.fromId(tabId);\n    if (!tab) return [];\n\n    const { session } = tab;\n    const actions = this.getAllInSession(session);\n\n    return actions.map((action) =>\n      action.tabs.has(tabId)\n        ? {\n            ...action,\n            ...action.tabs.get(tabId),\n          }\n        : action,\n    );\n  }\n\n  // TODO(sentialx): Tab in callback, fire if the browser action has no popup.\n  public onClicked(extensionId: string) {\n    this.emit('clicked', extensionId);\n  }\n}\n","import crypto from 'crypto';\nexport default function rng() {\n  return crypto.randomBytes(16);\n}","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n\n  return [bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]]].join('');\n}\n\nexport default bytesToUuid;","import rng from './rng.js';\nimport bytesToUuid from './bytesToUuid.js'; // **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\n\nvar _clockseq; // Previous uuid creation time\n\n\nvar _lastMSecs = 0;\nvar _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details\n\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n\n  if (node == null || clockseq == null) {\n    var seedBytes = options.random || (options.rng || rng)();\n\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n\n\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime(); // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)\n\n  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression\n\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n\n\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  } // Per 4.2.1.2 Throw error if too many uuids are requested\n\n\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n\n  msecs += 12219292800000; // `time_low`\n\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff; // `time_mid`\n\n  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff; // `time_high_and_version`\n\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n\n  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n\n  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`\n\n  b[i++] = clockseq & 0xff; // `node`\n\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nexport default v1;","import bytesToUuid from './bytesToUuid.js';\n\nfunction uuidToBytes(uuid) {\n  // Note: We assume we're being passed a valid uuid string\n  var bytes = [];\n  uuid.replace(/[a-fA-F0-9]{2}/g, function (hex) {\n    bytes.push(parseInt(hex, 16));\n  });\n  return bytes;\n}\n\nfunction stringToBytes(str) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n\n  var bytes = new Array(str.length);\n\n  for (var i = 0; i < str.length; i++) {\n    bytes[i] = str.charCodeAt(i);\n  }\n\n  return bytes;\n}\n\nexport const DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nexport const URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\nexport default function (name, version, hashfunc) {\n  var generateUUID = function (value, namespace, buf, offset) {\n    var off = buf && offset || 0;\n    if (typeof value == 'string') value = stringToBytes(value);\n    if (typeof namespace == 'string') namespace = uuidToBytes(namespace);\n    if (!Array.isArray(value)) throw TypeError('value must be an array of bytes');\n    if (!Array.isArray(namespace) || namespace.length !== 16) throw TypeError('namespace must be uuid string or an Array of 16 byte values'); // Per 4.3\n\n    var bytes = hashfunc(namespace.concat(value));\n    bytes[6] = bytes[6] & 0x0f | version;\n    bytes[8] = bytes[8] & 0x3f | 0x80;\n\n    if (buf) {\n      for (var idx = 0; idx < 16; ++idx) {\n        buf[off + idx] = bytes[idx];\n      }\n    }\n\n    return buf || bytesToUuid(bytes);\n  }; // Function#name is not settable on some platforms (#270)\n\n\n  try {\n    generateUUID.name = name;\n  } catch (err) {} // For CommonJS default export support\n\n\n  generateUUID.DNS = DNS;\n  generateUUID.URL = URL;\n  return generateUUID;\n}","import v35 from './v35.js';\nimport md5 from './md5.js';\nconst v3 = v35('v3', 0x30, md5);\nexport default v3;","import crypto from 'crypto';\n\nfunction md5(bytes) {\n  if (Array.isArray(bytes)) {\n    bytes = Buffer.from(bytes);\n  } else if (typeof bytes === 'string') {\n    bytes = Buffer.from(bytes, 'utf8');\n  }\n\n  return crypto.createHash('md5').update(bytes).digest();\n}\n\nexport default md5;","import rng from './rng.js';\nimport bytesToUuid from './bytesToUuid.js';\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof options == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nexport default v4;","import v35 from './v35.js';\nimport sha1 from './sha1.js';\nconst v5 = v35('v5', 0x50, sha1);\nexport default v5;","import crypto from 'crypto';\n\nfunction sha1(bytes) {\n  if (Array.isArray(bytes)) {\n    bytes = Buffer.from(bytes);\n  } else if (typeof bytes === 'string') {\n    bytes = Buffer.from(bytes, 'utf8');\n  }\n\n  return crypto.createHash('sha1').update(bytes).digest();\n}\n\nexport default sha1;"],"sourceRoot":""}